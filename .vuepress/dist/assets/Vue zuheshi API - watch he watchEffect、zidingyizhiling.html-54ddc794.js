import{_ as o,r as e,o as c,c as l,a as n,b as s,e as t,d as p}from"./app-9f91937e.js";const u={},i=n("h1",{id:"vue-组合式-api-watch-和-watcheffect、自定义指令",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#vue-组合式-api-watch-和-watcheffect、自定义指令","aria-hidden":"true"},"#"),s(" Vue 组合式 API - watch 和 watchEffect、自定义指令")],-1),k=n("p",null,"本章节我们将重点学习在单文件组件（SFC）中使用组合式 API。具体内容如下：",-1),r=n("ul",null,[n("li",null,[n("code",null,"<script setup>"),s("基本用法")]),n("li",null,"侦听器 watch"),n("li",null,"watchEffect 方法"),n("li",null,"自定义指令")],-1),d={id:"一、-script-setup",tabindex:"-1"},v=n("a",{class:"header-anchor",href:"#一、-script-setup","aria-hidden":"true"},"#",-1),m={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#%E4%B8%80%E3%80%81-script-setup",target:"_blank",rel:"noopener noreferrer"},g=n("code",null,"<script setup>",-1),b=n("p",null,[s("在单文件组件中使用组合式 API，需要在"),n("code",null,"<script>"),s("标签上添加"),n("code",null,"setup"),s("属性。 此时写在"),n("code",null,"<script setup>"),s("标签中的代码会被编译成组件"),n("code",null,"setup()"),s("函数的内容。")],-1),h=n("blockquote",null,[n("p",null,[n("code",null,"<script setup>"),s("是在单文件组件（SFC）中使用组合式 API 的编译时语法糖")])],-1),f={id:"_1、-script-setup-的基本用法",tabindex:"-1"},w=n("a",{class:"header-anchor",href:"#_1、-script-setup-的基本用法","aria-hidden":"true"},"#",-1),q={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_1%E3%80%81-script-setup-%E7%9A%84%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95",target:"_blank",rel:"noopener noreferrer"},A=n("code",null,"<script setup>",-1),E=p(`<div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">中的<span class="token keyword">this</span><span class="token function">指向与setup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法中的一样，都指向<span class="token keyword">undefined</span>
<span class="token operator">&lt;</span>script setup<span class="token operator">&gt;</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// undefined</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>&lt;script setup&gt;</code> 声明的顶层的绑定（包括变量，函数声明，以及 import 导入的内容）都能在模板中直接使用</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 导入求和的方法 sum(2,3) 输出5</span>
  <span class="token keyword">import</span> sum <span class="token keyword">from</span> <span class="token string">&quot;./sum.js&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 变量</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token comment">// 方法</span>
  <span class="token keyword">function</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;Hello Vue~~&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>count:{{ count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ sayHello() }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>2+3={{ sum(2, 3) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>最终渲染效果如下：</p></blockquote><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAXEAAACVCAIAAAAhR13TAAAdBklEQVR4nO2db2jb1vrHT37shQsbOJALMvRCBRnUIYU4bBCbmxdRyCAqvVCHDGrTC5m7Qefuwua0sDnri0zZILP3g/6SFbq4hQ07cIsd6LADC1Ze9CIFNuJCi1VoiAotSNCCBS3Y0IJ/LxzJSiLLki3/Sft86Ivj6ujokZTz1XPOec45PeVyGQEAAFjE/3TaAAAA3ihAUwAAsBLQFAAArOSdThsA6FMS72XSGzzHZXJPETruIl3DrgmSOGnvtGEAoE0P9NF2LeJmNPjZbGpH4xA2For+TPlO2tpuFADUATSlO5HYH6a839CiXh53+I8MNQEOC9BdQH+Kpbzkc2uxWd/AwlYzpZTY70hPVVAw4tPwSiqbpdPxxSDZr2RjFz7yx7S8GADoJGXAIoRUAJOfKsU2Xk7xT8qtvB7Mt8IV9x1+tRufwavvb3Jlt0m7AcBSwE+xjlJBt6liED5+dY7dS7sj6/HAgU6Td3DfzWRkRP65PhfbLFlwWQCwCNCULmMrMbe+l3TNR4NDmplcwe/Dsk8kLvyWkdpiGgAYATSlqyjRd5ZkZ4cMnnPXGtexjU3NKnJzi2ZAVICuwSJNeV2SpEY98JIkvbTGCut5XSq9buf1cuwtWVImvES/Tk6Xx6v03iwzD1prFgAYp/GYt9JTNrUaT67TzCZX7UfAnMQk6ZsOTE047TXLLon3MulEJrGeph+oTh0kTk/6vJ9MkboBXdJWLHZ377vsPBsidSqexMZ+kT/hfZ7AjPtgueoMJ72hMzhCCL0W2dux2C/xtHJfmJM8GwxdDRIYOshOJrrGVZKF+7zy38yv0ehdVTalcITQy9zyZ35qlUODvrnfYsEhlS+yk68O9owNq3piNXCN+BGKVtIsx6N/6GcHgHbRSMfuMyZyznm4fqmpNfBRuB8PjemfirCxUJKveXEh4a17lT2exKtZp+OCfoZ5plwuF7mVQE2RwgOJQ2MsLFXvAVcLr8DMq24fC2dVozqFO0HlSPBOQffeyuVHK4SS+3K2WCc3ALQJ022f0r3o6VOe2VXO/BhHibt1YfiUP7pZ51RxMzrlHl/YavdwRmlr4fTYhdoRH3zM55ndaNIqkb+vun2RE59XfxVETk5iDke9YLY+h1NJPxahRwXoEsxpSmlrgXDNZpRK0U8Gr6XzQqH4qlwul4uFwm4uuXSR1PTC+dUA8UlMaR7g01SczguFyve1WCjsMgnKq/gIIj13NpB43MAdNcqzNHVxjhYRPh1J5nYrdhULu8zNkKrJI0avRFm1qvS5IouRyr/weZfy3+TFiPL/kcVIZEgpAnONVqNP0IjHebz6SxRpOenB6zhzCNl7HUr6Li8Yv1MAaCkmfJoXTFg1tInPrORf1MgpZJlH+//n0QqpOlWjEVHBQEBXq9o+CCGEkT9tazQi+LhPVcNDf2i3MwwbVmAWA8QEQcxEmGf7CohPKwX4khrmHmA7Un0dFFM3OwC0BROasr1Y/Q5j5+NmwjcLyZlqnfT+qn/q7spk9TqHuxVapynYxXStPozdGypJ/Fa7/powTBu1phjRCLP5AaAdGG77PE8tX8nJlS8U/9lnYphhJxm7JacnVyLn9U/F/VcpWb3E5TW6XT0FJPUVWasPA5/0VwXjAc/XyAYAgFFNkVg6JqeJ+SDxrolr8JuJjJwOfDpVV4xsI6S/GtDFbLenr/asXy8e5LhzWGn+rPFWxOADwJuJQU0pbd9dltOEb8xUKITE5ZSuRy/hMjI33+U5o6Tp3EMzV2sYF657Vw58tC1mAMARx6CmCGJ1hNU9oBffeRieY5X0MH7C0DnY+0pTI1fo2ijbFlIo1vfOBOFRGywBAHMY1BSRX5OTE/VHOfdTKt2Tk2eNnntMFYPLPXlLmho2e5+S5tVxKzVo5MECQKsxP9/HfuxYw1d7BzV+7puPOuBEqu+nSIVqTApm722NTQBgFvOa8khoPLyqoXOdf39bvsHYCaXFR3N8PVF5LihRt67360bdAkCbMKgpNpsyEHNPKJgbiMGwCdPnCo8ZOenqNTPGdKTB8Wq0Pf2A08mJ9nd9E4NOvawA0EYMagrurAaUmx2IceDVcE+D54pcTulDIVwna+Yr6i9EUCoesVkwgx5lEmGOrTOjiruXlJNB4kNYQB/oFgxqin14tDoQE/+dNeOp2IZHqzUl8h+6/rnPGfq2nJ7xDO+vL/a+6pgvy+lFn4l/Zmidw12IfdijhMbejqd11q8u0emfZc2ZITzQ8gG6BqP9KdiEPyCnc1epuJnl2u2jZFBZ6fCHaL1zS+x1So6vw8LnD8a22nCnMsefXqNri0ouvpgyYWVXgJHnlMecWV7L1conrScW5MVdgmcJkBSgezDcR9tHBr9X2j+ZC+fnaL3BTklSH7WTgStGz5U2qNBVuS5NUoGxQ159/0B1ovD63LL24gMl9rvg7D2tI63jnaqpjK4DhcRc6lYstcUfbprZJ33KSrO5K0HtBR8eJ4Kfy6o7Mhs4A5ICdBMm5ga9YKgR1ZkYEUpsF17tz/OquEsvBcawg5Poitv7zu33Rmjh4PTeopBd9KqCWb3xGiszqWczIowIZ4QD5aS/JTCEEIZVR4yMrclUGwMT9nKRqllDobRqznGhUL3XIlvdasM9zxye41y4E6yajZEUvc/wwv14sPok3RQLizEB3YXJdd72z/pHCCGEuye8wW8jkcVQYMKtKILGxFw+HRzZfyrmJCYCocVI5HKAGDuwcJxubXmWDu7PjQ0S3ovh/Ta4I3dMr/NWGyOTgNWLDyCEcPd0MPxt0DuCqwoXkufVeTTXNCgy8251JmyQCFyORCpFqf7bV2vJCADoHObXjnyWDddb/BHVmuxf2F6aNjBXqD9wcKOsQ6i/9lq4w38UGlg7sjaGFhaoaVW18EL6ovpArXVSdtNf6N4fwr3XtJZ6AYBO09g+hIV8ivINaisLPhKgUvnai6kWBXopOKmtLNggGbrJCK9qnryvIC5JaSkUPhmKVySp7ZpSLpcLdyPeQ/Oh8MXtqtn12j7VS9IRzYeMT1PJ+/VWqwWADtHUHuwliedyfKEkcg+Kjg9w+zHHwKATMxii9lLkHuSFosT/JRwbdGK2XtzlxO2m4ywqNvCPczzCXSccjlMuZ1/HgzVK0sPctlBECCF0TMMkMUdzBdQ7QAzV9/hKj3MMX5Ae5wSb04k58A9d+FsTBAgcRZrSFAAAgAPAPoQAAFgJaAoAAFYCmgIAgJWApgAAYCWgKQAAWAloCgAAVgKaAgCAlYCmAABgJaApAABYCWgKAABWApoCAICVgKYAAGAloCkAAFgJaAoAAFYCmgIAgJWApgAAYCWgKQAAWAloCgAAVvImaYqY+LhHZoE9fHxrQTk8taq/GTEAAA3yjpnMJUlStsWz2c2sR60609yJbyCvS9LLBh+jTOMvAgBajRk/5Wkq0CvzWcrMh15MfaacGdXwIN4qXjMRp/I0PFHzG7CWNuaU83u/oQ9vkAoAHeRNavscEWzE6c+VLThy8Y2aG63XQKLXonIaC0/DBuxAdwGa0gHcZ2aVnZVzCdqcqDynU9flNBYg3NDwAboL0JROMET4lZ2V78VpM80f6W4mJqexz08TIClAlwGa0hFcxL+qnkrkd+NdTGJmVZEU1+wZ/T2VAaADgKZ0BteZICGnxZ9po6LylE7eltNDfmJILy8AdATQlA7RT/gm5bS4RG8ZOonfiKfkNPlvr0svLwB0hq7XFHUoRgcpSdJLa0vEiWlSTotLd2gDd8nTtzNymvSO4tYaVI8ueRNAt9OVmvJaZFejl/454Ojp6TnW23usp6fHMUBcmL2V4dsXjFES76ViVy6Mn3L0VMx4r6enp8dxavzClVjmoQV24BN+r5wWb9FM3Qq7QyfW5fRMYKpfdUhiYz9Go5V/v/O6pUjsLTnnjzG23n2IW4no56f3vYnKE9iBsBigBmXjPIkrdQBNxwUTZwrxaeVMitHNWrgb8fZrGVoBI0Kp3QavwlLKYW9Cz/zC/XhoDNO6vMqQsVCSN/wAalwnOVMtL0wX9XPv3lB6YFAgVdh3TP1q5vUfsPopeeNPamd8xkSmdVwhjPgyufvK6K0Cbw9d5aeUuF/8ztHZ1E7tLCId9Xr8q/qf4uZsuHVh+JQ/ulknTljcjE65xxe2mmkO2ImzQaW8hXV9TyWX+pmW00HvWGsj3UoPY/5TntnbOs9ZpP93yvNJonVvAjiidJGm8KsB4rPEXlXGiMC17O4LWfpe7DI3Q8Se6yAmfP6Fv1rStudXA8QnMaWe4NNUnM4LhYoHUSwUdpkEVXWjRHrubCDxuPHL2Se8IeXHjxk9UblHx+UwFuxrb2uDZx8nAmMXqm/i06UsL/tQr4q77IrixIm/+f0/5KCXBdiHCZ9G7WCfXckXjJNfOaucWaPtw6sKx3xxrWZFkaWq8RiTK4eaQE23fR6tKL2mCOGBRI1G1qvd+IyqUaBhiXGK2a+rjazQHzWbP9uLyiCPVivJyrbPrioD5vtV6+ZeMNSIkodceVT/PoG3h0Y1pXE0NaWQvqhULTfF1qxauzeUWu+K5A4cbFJT1L0byKtZl1SGrCgjwQgL3inoZtajSIeronIxXaOg7YgSijIU2T583DpNKdwJVt/EPFPzTaj017WoYRHw1tIdbZ+d5PJ12dW+TIVGagac45PKWEkuvml29l0dG2K35PTkSuS8/kgt7r9KyZ6DuLzW+ORg29jpS0olvp5hNAvaykTkho/LR7QyLIVPXl+W30SI+rL2bKL+035Zm+pMWRLZxI+Xpj4aH/9ofPzjS9FVVqzdWMr93/j4R+PjH40v/1XfVmknE7tyoZJ//JPZ2Donva5pROarSsmzGVg5p9WY0J+W+SmqEY3D3scBVF/s88n9zkZTforeqEpdS1AoW2fQRregarsGabk86vZRjedjlZ/yaKX6Jup5H9s/KWb7kjWG0XbvBDWmD2BO32JW0Bgz2l2ZqGHYQYrbP5EaI3P9ZCiR13h5xazcb1Vn2BFoHlNrMqmYCCe/Nt5RKNE/TC1s1DzK5ZQRDdJTJ97c4XgfocpHe4MTEKoz5GvYQpUNXsJl5M5cnjOyJYjOPUQNR8q7JvwulKt86pfXaOqMd9/lSwx9S/62Tga9rYzH3/cm3HX8IQeGI1SxmuaearyJ0taC/5/LGtMORC5xZZxeD0WvzfkGVfd6LxWr/JEMeZzH9S7NrwbIr7Qcjp1M1JdJrUVWrik9+gghJG2k4pXURZdT/66ApmlUU+wDnjHCcH0Wxes6R3lO+bvDUnMf1Zn7ItxXSkXWjTiobEDD+AlD52DvexGqxMrnCs1E2Q4R/iGUq8jTrQy96PX2VQ+WWDom1x5ymmhp8Cy/w8hJLHV1nNX/6xDyckpEGo2O3PKXc5WH6v5iJfrVlNOOCo/p1PezlSFqcTPqPxWnzs1SV7zEid7Cw/jC+dm9/P/Sbd89z0S/qoxKYeT3sciMx2ErCbl07Lu5SgQAf3t2/PYyeTkc+uT0MIaEzaVLn1cadFhw0gPLzbQcEz5Nq2LeGErLMAMcKKqZto/KhrNxg+M4QsJbu0Bz7N6sjjjtb3kVs5erR5LPapxvUduHmW/0TbCHrpOL7OnCyMFO5TphjSMU8+JQaerT7+wF9WAHu7SL+URI50OHnTf6ZoFm6I4+2q7iHXSs7dfER72KqMRWVV69RKd+lNMzJNGHjgoix1TaRcQnB+c62v8RSnJCdtGr4XONBNOrYfe7eiVz95YrCf/ZA61vm/NcJMvl419qCAt2JpL52dfmKVJvJ422fVrESSrLBoeN5ra1xI99JDTQTeP8e3MdO/2n/dMoU1nH4HaSfurzHUcIIWkztSxnCZ0j2+i3OymaCRoeYbIdUgFBKhETBELIfbxX44R3MOJycvcLkV1LJjdSuafI3u8mz/inJpz2On+SUuEFQUwghOxOh9aolN3p+ynr+4bL/B7PrLOchPAhL+Gd8o5gsHxVe+gGTcGwCYQqnXMP0TG7vRMtXpUN94RCCSEDf4DCY6X3wdWr+2k1YgB5LoBuV9ZbSiXvir5zGEIS/bu8AhMWJkdbXikwjECo0kvLNfkmXBfT2Yv1Mtkw97mg+1ywXj41dnIxS9bN1eckZyhypm4+wHq6oe3jwKtjGXReZ7JPu2zIPTRyisjllDYK4TrZrAX2UTIgp1O/pXmE0HM6I4fMYDOEx6CkvNI/XCzWjqVxnKh6JvR9mMoDNEI3aIptwKX0MNKpux35U7YNjypfy1zkPwZWM3nO0MqSazOe4eZ9iD7Cq3zY11P0DhI34rKX4pr9WHfl2T6s2lOwldd7gk/ZTM1BfWRzDlffxBoNogI0QDdoCsI+JBVvNnMtxlq8+pEh7KOkEpQu/hCN13GXSux1qtosOW9JT4edOKvMKMzQuRy9Ji/qVneZSBvunJDTGym6tvG51Uiq5kGEjrtJZc7B+nLsvzA9EDBNV2gK6p8KKvN97i14P683g/5xannd6hBrOxm4osR8Zi6cn6Of18wrbVChq3I8+iQVGLOmp8M2SiqTfxL3k3nZDyI+r7tMJD4wqnQSZ+ZuaPtZpa2F4BX9CQ341EVFWnML0/VmXb/mU9ch2B3Yj4lx55auycTHfaqRE+wMlX2iEe5efMKsXCZx7XiQpuclF7dV020R6vdGaOGgEcUDg6BezSnUDcPMHx4/MjbxV4kHQQghjPg2vT/4vShkwgSGEMIwTGW85rzk8+o3QVKHH0K5XC4KzM0Q2W/2LwF48+mGcR+EEEInfNQNhpdDucXf58Z/n8MGidOTpPNvCCEkcBnmLs3KXn1L5tHZXOHVtHDu9HJlxemd1CyRmsWcxCmPa8LpeMZl/mLym5zqs+ym2LjPWNCtQdxnZl1XZ/f5EpNeQidCTGEoQF2MnN6biinS3512/OIkRgn3h3hJ9ejcP8Uusaf9t3UKwn3zMeaR/BDEzBzhmMOcxCRJOh0IIfSMy9yl6S3ZlYSFtoEDmNCf1q8dWfgjbCjgHyMo+vBMMYvWjixsL+mtmSjTH1jhmpg4WBP11ESEjE5oLJfLB5Y10cD9dbZgcO3IZ9lwvdUz997EfLbxhR6AN5Hu6E+RsU9QWS6fnPc5a/w9Y4Nk8Fp6l8uGW7d4ot0V/E9eoJeCk9rKgg2SoZuMwK0ETrYiYES9nRhCKECOGr7Td93hjXxyXis+tZ8MJfL094anffYRFM3lU5RvsNabcJIXl9KPuOy3sGEzsI+ecrncaRu0eF0Sd3J5oSg9zvEId52wo2OOgZM4Zm9vMORLkXuQF4oS/5dwbNCJ2XpxlxNvsw0NUJL4h9s8z+d2EP4B7nAMu042bnRJ5HKcUJT2SrOjYw6ns+1vAjgydKumAABwNOmutg8AAEcd0BQAAKwENAUAACsBTQEAwEpAUwAAsBLQFAAArAQ0BQAAKwFNAQDASkBTAACwEtAUAACsBDQFAAArAU0BAMBKQFMAALAS0BQAAKwENAUAACsBTQEAwEpAUwAAsBLQFAAArAQ0BQAAK2l0f5/nHHuXYXY4biPHI4SOu0inEx/1EB847R3fMuh1iX9As3c54QmXuccjhOz9bo9zwDlKEENYh1dmfilJrw1ltL1rt3X8SQJAA5jevUPIRs7V2ioDIczpW8zu3wGvjTzb1tnHA6G9rQU7ZFx5/w5EdaDYzpkJAE1gTlN274SM7OmFjVFMJzaSYuYNVVf3fEesK4OmAG8DJtxraf2S55/Lys6e+EjA63V7PsDtSOL/YthUKibvdyluznkm0fZm2NWhlgY+EvB6XcODTsyGSiLH5ZjYbwllU1L2qseP7aY/NbDZoMUIwqO2XxMA2oxx+RESla1NMeLTJc0N0gWaIlVeDHlj1zrtMwQzj/DpiKZt5VdC+mu36r5rb+vZQhhld1XvjXxBl2Kn2o8A0BwmNQUjwhm9/ogiS1UrLqa3NXIrKAj6fSW76qaH3pbJLaKYDclXD/3Rir2WAaDzmBlLfmc4zmapSb0OFdtIiLos/xCTzD0TxTePHdPv7MG9nyqVGqU4vtX2HOS5qFyy9z3YGhR4MzGhKdh02Heibi7b8GhQTueEZ6WGrGoVNuewV/nxkBd1srYWlw0kBXhDsT4Ewv43h5Lmn0sIGRgoUpDY2C+MhBDq8wRm3HbLjVNzAmtt+Yd5yqf2Urijr83XBoA20YKwqtdFJYn3may2L/nMldkUQmg67p9x181uGlW8mcvR2zlfwQbxbMCbivWx+TzHykmX42/d5eJLOVr2FFz+MVebry4+ycvJAYcZ7w0AjhCWawpPr9FymnCdtLr4ZnjJRuZje+nJoHeo7Qa87q7eJQBoBRa74KX/xpbX5R+XSU/3uCliZs4XWKiMQ2G++M8BnYg3aSsWuys1dh3n2RDZr32o+FIu8x9FfpOuNhGPOQZO4pi9ex4WADSBlQPTLxhqRCnYHcmZL+FJfG9cZjrecPRIURU5JnBMNrUSUk9QGgkm+TolyNF9jaATU19n6kC/OzAfZzo4GwkArMA6TXnBUGPVmuueZxoJ6rJAU2rOqcEGfVSCMTK/sVWa8q2RAnDvte0OTUcCAAuwqO3znJ47M76wtfcLG6OiX7q7zJXHPZPDmM2GXtdv8NlH57J0sE6mGjhqNHwQEvmHCCGE+t0Efmzv/17w9NaB0Ds+9e9h4VE6fo1s/3wkALCA5mWpcHffNB9sjGJeNFpWK/0UGdy72Kl5ydoUhXz6WuDAhG/vr+2eLQUAltCcprwS0t/uqwv4zEregKC0qHGhSbEg5Nnk0sV9n33sfLzrqmxhO3JGrc3B9LNOmwQA5mlCU/hkaGyfnhjvCGinpqiumqXONN3j01L2dXJ3YpYjADRNg/Ep0sbcuHsquinPmBkJxu9vJ79wtTva3RQYEU6klErLXqXiOx215zDvuoNXAsqvVC4PAS3A0cO8DBXzN3xqH534Mrlr1WIfVowl61NIVSut66ft1lykCQrpaudwyx4CALQOs+M+JfaH095vaFHWk/DNuP7qB92G3UV4UawSoZ97JEhIw7dqUcybMft6q1Mw7/KCuSmYANB5zGkKvxqoCspIMLm65K2/+kGXob7j55Jm46LEZ2avpLSO1IcabU5T1Ljxrm5LAoAWZjTlcWLWl5AFhWI2wu53W2JT++jrvnh4qSAo6Xdtx3RyAkBXYlxTSvSN0N63G/PFV4+soDzlGTnpet+h6Qi0JubNENJmallOE6MuaPgARw7DmiLRqR/2fBTXV7MGFnzrTqTMr0vyYBU25dZe7sB23EUcb59NVV6yy4vyzGnkIj+ESFrg6GF0LLn0J139fg45W2RNE4ipH2NcnX7VEvdLMHBdlpRJyjeim91adlhaf63K13zic++cMr/hIhVo/2oMANA0Rv0Uobo8M5J2GNqwf+M4RTjbsk5i6c8LA1cWvPPU7Hmv+8TBfpLSUzp2de7SLWW9KDc172+rG/CcHn/fT14Ohz6ZIk4eaHKVxK145Ju5arwP5oteIaGDFjiK9JTLZSP52O96PFcbuQDFlsPG3YGSmGPzBYTQewOeD0ztbSwmPnb4b8u/+t0EPuCacDpQgf+T5bg8/UDtJLiDd+JLZ9rbstha6HHP7aUxJ3HK6Rzx4O8J3EaOuU9zauswglpLh0e6rvsYAIzQZcui2jDXmBX9kjssvcPSG1qH+gMra5HAYEedAJGjRY7e0BiuxsZCyzcjR2+EHgBkrF+PtkNgvhu76WtBndgQfCRApbYL3EpnBGXQq78/PD4SoFJ5jgZBAY42Rts+R4iSJPIP80IRSY9z/EuHcxCz9eLD/bi9Kwa/S5LIc5xQlPjcjoSQzTHoxHodA4NOrCvMA4BmeQM1BQCADvLGtH0AAOgKQFMAALAS0BQAAKwENAUAACsBTQEAwEpAUwAAsBLQFAAArAQ0BQAAK/l/dxFiis6LcJcAAAAASUVORK5CYII=" alt="image-20230518205257172"></p><p>注意事项</p><ul><li>在 <code>&lt;script setup&gt;</code> 中创建的变量不会作为属性添加到组件实例中。</li><li>如果在某些情况下确实需要从选项式 API 中访问到<code>&lt;script setup&gt;</code>中的变量，建议切换到<code>setup()</code>函数写法</li></ul>`,7),y={id:"_2、响应式数据",tabindex:"-1"},_=n("a",{class:"header-anchor",href:"#_2、响应式数据","aria-hidden":"true"},"#",-1),x={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_2%E3%80%81%E5%93%8D%E5%BA%94%E5%BC%8F%E6%95%B0%E6%8D%AE",target:"_blank",rel:"noopener noreferrer"},C=p(`<ul><li>在 <code>&lt;script setup&gt;</code> 中声明的顶层<strong>变量</strong>并不是响应式的，需要借助响应式 API（如<code>ref()</code>或<code>reactive()</code>）方法来创建响应式变量</li><li>如果变量为<code>ref</code>对象，在模板中直接使用时会自动解包，这一特点与<code>setup()</code>函数中是一样的</li></ul><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 导入求和的方法 sum(2,3) 输出5</span>
  <span class="token keyword">import</span> sum <span class="token keyword">from</span> <span class="token string">&quot;./sum.js&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 变量</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 函数</span>
  <span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    count<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// ref对象需要打点vaule属性访问值</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>add<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>count+1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--count会自动解包--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ count }} --{{ sum(2, 3) }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>以上代码最终渲染效果如下：</p></blockquote><p><img src="https://www.arryblog.com/assets/img/GIF2023-5-1819-50-13.60b8aa74.gif" alt="GIF2023-5-1819-50-13"></p>`,4),B={id:"_3、使用组件",tabindex:"-1"},V=n("a",{class:"header-anchor",href:"#_3、使用组件","aria-hidden":"true"},"#",-1),j={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_3%E3%80%81%E4%BD%BF%E7%94%A8%E7%BB%84%E4%BB%B6",target:"_blank",rel:"noopener noreferrer"},T=p(`<p>在<code>&lt;script setup&gt;</code>中直接通过<code>import</code>导入需要的组件，然后该组件就可以直接在模板中通过标签名使用</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> defineAsyncComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 导入组件</span>
  <span class="token keyword">import</span> List <span class="token keyword">from</span> <span class="token string">&quot;./components/List.vue&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 定义一个异步组件</span>
  <span class="token keyword">const</span> AsyncComp <span class="token operator">=</span> <span class="token function">defineAsyncComponent</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span>
    <span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&quot;./components/AsyncComp.vue&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--使用组件--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>List</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>AsyncComp</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>对于全局组件可以通过组件名直接在模板中使用</p></blockquote>`,3),I={id:"_4、动态组件",tabindex:"-1"},M=n("a",{class:"header-anchor",href:"#_4、动态组件","aria-hidden":"true"},"#",-1),L={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_4%E3%80%81%E5%8A%A8%E6%80%81%E7%BB%84%E4%BB%B6",target:"_blank",rel:"noopener noreferrer"},S=p(`<p>在<code>&lt;script setup&gt;</code>中组件是通过变量引用而不是基于字符串组件名注册。</p><p>所在模板中使用<code>&lt;component&gt;</code>动态组件时，<code>:is</code>的值可以直接是组定义。</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> shallowRef <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token constant">A</span> <span class="token keyword">from</span> <span class="token string">&quot;./components/A.vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token constant">B</span> <span class="token keyword">from</span> <span class="token string">&quot;./components/B.vue&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">/*
    我们在更新currentComp的值时，只会用一个新的组件替换现有组件，并不会去更新组件中的内容,
    即currentComp只需要做浅层响应性,并不需要做深层响应性，所以选择用shallowRef而不是ref，
    */</span>
  <span class="token keyword">const</span> currentComp <span class="token operator">=</span> <span class="token function">shallowRef</span><span class="token punctuation">(</span><span class="token constant">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentComp = A<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>A组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentComp = B<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>B组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>

  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>component</span> <span class="token attr-name">:is</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>currentComp<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>component</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>以上代码最终渲染效果如下：</p></blockquote><p><img src="https://www.arryblog.com/assets/img/GIF2023-7-1017-37-36.5f2fe25d.gif" alt="GIF2023-7-1017-37-36"></p>`,5),J={id:"_5、计算属性-computed",tabindex:"-1"},P=n("a",{class:"header-anchor",href:"#_5、计算属性-computed","aria-hidden":"true"},"#",-1),z={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_5%E3%80%81%E8%AE%A1%E7%AE%97%E5%B1%9E%E6%80%A7-computed",target:"_blank",rel:"noopener noreferrer"},N=p(`<ul><li>在组合式 API 中使用计算属性，需要借助 Vue 为我们提供的<code>computed()</code>方法</li><li><code>computed()</code>方法接受一个 getter 函数，返回值为一个计算属性 ref，计算属性在模板中使用时会自动解包</li></ul><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> price <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// newPrice为计算属性，是一个ref对象</span>
  <span class="token keyword">const</span> newPrice <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> price<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token string">&quot;元&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>newPrice<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 10元</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--newPrice 会自动解包，所以不用newPrice.value--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ newPrice }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>如果计算属性需要<strong>可写</strong>，则<code>computed()</code>方法接受一个带有 getter 和 setter 的对象作为参数。</li><li>当读取计算属性时会调用 getter 方法，为计算属性赋值时，会调用 setter 方法</li></ul><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> computed<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 为计算属性</span>
  <span class="token keyword">const</span>  <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function">get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;读取了内容&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">set</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;更新了内容&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),G={id:"二、侦听器-watch",tabindex:"-1"},D=n("a",{class:"header-anchor",href:"#二、侦听器-watch","aria-hidden":"true"},"#",-1),X={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#%E4%BA%8C%E3%80%81%E4%BE%A6%E5%90%AC%E5%99%A8-watch",target:"_blank",rel:"noopener noreferrer"},O=p("<p>本小节将学习如何在<code>&lt;script setup&gt;</code>中使用 watch 侦听器，主要内容涉及如下：</p><ul><li><code>watch()</code>方法的基本使用</li><li>侦听数据源</li><li>副作用清理</li><li>配置项</li><li>实战应用：单位千米与米的相互转换</li><li>停止侦听器</li></ul>",2),F={id:"_1、watch-方法的基本使用",tabindex:"-1"},H=n("a",{class:"header-anchor",href:"#_1、watch-方法的基本使用","aria-hidden":"true"},"#",-1),R={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_1%E3%80%81watch-%E6%96%B9%E6%B3%95%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8",target:"_blank",rel:"noopener noreferrer"},U=p(`<p>在组合式 API 中，我们需要使用 Vue 提供的<code>watch()</code>函数来侦听一个或多个响应式数据源的变化，并在数据源变化时调用所给的回调函数。</p><p><strong>语法</strong></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">watch</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> callback<span class="token punctuation">,</span> options<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>参数详解</p><p><strong>source</strong>： 侦听的 <strong>“数据源”</strong>，他可以是以下几种形式</p><ul><li>一个响应式对象（<code>reactive()</code>创建的对象）</li><li>一个 ref 对象（<code>ref()</code>方法创建的对象）</li><li>一个 getter 函数，返回一个值（可以用来监听一个对象属性）</li><li>或以上类型值组成的一个数组</li></ul><p><strong>callback</strong>：侦听的数据源发生变化时要调用的回调函数。这个回调函数接受三个参数</p><ul><li>第一个参数 newValue，表示数据源的新值</li><li>第二个参数 oldValue，表示数据源的旧值</li><li>第三个参数 onCleanup ，一个用于注册副作用清理的回函数，该回调会在<strong>下一次数据源变化调用 callback 函数前调用</strong></li></ul><p><strong>options</strong>: 是一个可选的配置参数对象，支持以下选项</p><ul><li><strong><code>immediate</code></strong> 当值为 true 时，在侦听器创建时立即触发回调 ，默认情况下是 false</li><li><strong><code>deep</code></strong> 如果数据源是对象，强制深度遍历，以便在深层级变更时触发回调</li><li><strong><code>flush</code></strong>：调整回调函数的刷新时机，<code>flush:&#39;post&#39;</code>表示在 Vue 更新之后 DOM 之后调用侦听器回调，可以侦听器回调中访问到 Vue 更新之后的 DOM</li></ul>`,10),W={id:"_2、侦听数据源",tabindex:"-1"},Q=n("a",{class:"header-anchor",href:"#_2、侦听数据源","aria-hidden":"true"},"#",-1),K={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_2%E3%80%81%E4%BE%A6%E5%90%AC%E6%95%B0%E6%8D%AE%E6%BA%90",target:"_blank",rel:"noopener noreferrer"},Z=p(`<p>侦听的 <strong>“数据源”</strong>，他可以是以下几种形式</p><ul><li>一个响应式对象 （<code>reactive()</code>创建的对象）</li><li>一个 getter 函数，返回一个值 （可以用来监听一个对象属性）</li><li>一个 ref 对象（<code>ref()</code>方法创建的对象）</li><li>或以上类型值组成的一个数组</li></ul><p><strong>侦听响应式对象</strong></p><blockquote><p>数据源是一个响应式对象，默认是<strong>深层侦听器</strong></p></blockquote><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 只要是该对象的属性（或嵌套属性）的值变化了，侦听器都能侦听到</span>
    state<span class="token punctuation">.</span>count<span class="token punctuation">.</span>a<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 侦听state响应式对象 默认是深层侦听</span>
  <span class="token function">watch</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;count的值更新为&quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ state.count.a.c }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>侦听 ref 对象</strong></p><blockquote><p>数据源是一个 ref 对象，默认是<strong>浅层侦听</strong>，添加<code>deep:true</code>配置可以开启深侦听</p></blockquote><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">c</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 如果watch中不添加deep:true配置，则以下修改没有办法被侦听到</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>value<span class="token punctuation">.</span>count<span class="token punctuation">.</span>a<span class="token punctuation">.</span>c <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 以下修改可以被正常侦听到</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">watch</span><span class="token punctuation">(</span>
    state<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;c的值更新为&quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span> <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>侦听响应式对象的属性</strong></p><blockquote><p>你不能直接侦听响应式对象的属性值，需要通过 getter 函数返回该响应式对象的属性才可以。</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 下面为错误写法，无法侦听到state的count属性</span>
<span class="token function">watch</span><span class="token punctuation">(</span>state<span class="token punctuation">.</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// .....</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 以下为正确写法  侦听state对象的count属性</span>
<span class="token function">watch</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
  <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// .....</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>以上方式<strong>默认是浅侦听</strong>，侦听的回调函数只在对象的该属性值发生变化时才会触发。添加<code>deep:true</code>配置可以开启深侦听</p></blockquote><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 添加 deep: true 配置时，以下修改可以被侦听器侦听到，否则侦听不到</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>count<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// 侦听state对象的count属性</span>
  <span class="token function">watch</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> state<span class="token punctuation">.</span>count<span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;count的值更新为&quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token literal-property property">deep</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 开启深层侦听</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ state.count.a }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>以上代码，如果不添加<code>deep:true</code>配置项，当通过<code>state.count.a=100</code>来修改 a 的值时，侦听器是没有办法侦听到的。</p></blockquote><p>侦听一个数组</p><ul><li>数据源是由 <strong>getter 函数、ref 对象、reactive 对象</strong> 类型值组成的一个数组，会侦听该数组中的每个成员的变化。</li><li>如果成员是<code>getter</code>函数和<code>ref</code>对象，默认是浅侦听</li><li>如果是响应式对象，默认是深层侦听</li></ul><blockquote><p>侦听器回调函数的参数 newValue 和 oldValue 值为一个数组，数组中的每个成员对应数据源中每个成员的当前值和变化前值。</p></blockquote><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;Hello Vue&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">count</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> num <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token function">reactive</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">2</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    num<span class="token punctuation">.</span>value<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">// 侦听器侦听不到</span>
    num<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">a</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 侦听器能侦听到</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    msg<span class="token punctuation">.</span>value <span class="token operator">=</span> <span class="token string">&quot;Hello watch&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 侦听器能侦听到</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">.</span>count<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">100</span><span class="token punctuation">;</span> <span class="token comment">// 侦听器能侦听到</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    obj<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token punctuation">{</span> <span class="token literal-property property">b</span><span class="token operator">:</span> <span class="token number">100</span> <span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token comment">// 侦听器能侦听到</span>
    obj<span class="token punctuation">.</span>a<span class="token punctuation">.</span>b <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span> <span class="token comment">// 侦听器侦听不到</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">4000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token doc-comment comment">/**
   *  num.value 是浅侦听  只有num.value的值变化才能侦听到
   *  msg 是浅侦听，只有msg.value的值变化才能侦听到
   *  state 深侦听，state的属性或嵌套属性都能侦听到
   *  obj.a是浅侦听，只有obj.a的值变化才能侦听到，其内部属性变化不能侦听
   */</span>
  <span class="token function">watch</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> num<span class="token punctuation">.</span>value<span class="token punctuation">,</span> msg<span class="token punctuation">,</span> state<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> obj<span class="token punctuation">.</span>a<span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;数组的值更新为&quot;</span><span class="token punctuation">,</span> newValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>以上代码最终执行结果如下，侦听器回调函数被调用了 4 次</p></blockquote><p><img src="https://www.arryblog.com/assets/img/image-20230710183920391.c42d1840.png" alt="image-20230710183920391"></p><p>总结：</p><blockquote><p>侦听的数据源是</p></blockquote><ul><li>一个 getter 函数，用来侦听对象的某个属性，默认是 <strong>浅侦听</strong></li><li>一个 ref 对象，默认是 <strong>浅侦听</strong></li><li>一个响应式对象，默认是 <strong>深层侦听</strong></li><li>或以上类型值组成的一个数组，数组中成员的类型与上面侦听的方式一样。</li></ul><blockquote><p>可以通过添加<code>deep:true</code>配置开启深侦听</p></blockquote>`,24),Y={id:"_3、副作用清理",tabindex:"-1"},$=n("a",{class:"header-anchor",href:"#_3、副作用清理","aria-hidden":"true"},"#",-1),nn={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_3%E3%80%81%E5%89%AF%E4%BD%9C%E7%94%A8%E6%B8%85%E7%90%86",target:"_blank",rel:"noopener noreferrer"},sn=p(`<p>在某些场景下，当监听的数据源发生变化时，就会向后台发起请求，如果数据在请求还没有回来时，数据源变化了 5 次，那就会向后台发送 5 次请求，完全是没有必要的。</p><blockquote><p>所以我们需要在上一次请求没有回来前，如果数据又发生了变化，则把上一次的请求取消，再重新发送一次请求。</p></blockquote><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> watch<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 侦听器，侦听属性count</span>
  <span class="token function">watch</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue<span class="token punctuation">,</span> onCleanup</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">数据变化了从</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>oldValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ==&gt; </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 模拟发送请求</span>
    <span class="token keyword">let</span> timer <span class="token operator">=</span> <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;发起请求......&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 取消请求的方法</span>
    <span class="token keyword">function</span> <span class="token function">cancle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;取消请求&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">clearTimeout</span><span class="token punctuation">(</span>timer<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 清理副作用的回调函数</span>
    <span class="token function">onCleanup</span><span class="token punctuation">(</span>cancle<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>更新<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),an={id:"_4、options-配置项",tabindex:"-1"},tn=n("a",{class:"header-anchor",href:"#_4、options-配置项","aria-hidden":"true"},"#",-1),pn={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_4%E3%80%81options-%E9%85%8D%E7%BD%AE%E9%A1%B9",target:"_blank",rel:"noopener noreferrer"},on=p("<p>关于<code>options</code>配置项中每一项配置的含义，与前面讲的项选项式 API 中<code>watch</code>是一样的。</p><ul><li><strong><code>immediate</code></strong> 当值为 true 时，在侦听器创建时立即触发回调 ，默认情况下是 false</li><li><strong><code>deep</code></strong> 如果数据源是对象，强制深度遍历，以便在深层级变更时触发回调</li><li><strong><code>flush</code></strong>：调整回调函数的刷新时机，<code>flush:&#39;post&#39;</code>表示在 Vue 更新之后 DOM 之后调用侦听器回调，可以侦听器回调中访问到 Vue 更新之后的 DOM</li></ul>",2),en={href:"https://www.arryblog.com/vip/vue/mastache-event-computed-watch.html#_2%E3%80%81%E4%BE%A6%E5%90%AC%E5%99%A8%E9%85%8D%E7%BD%AE%E9%80%89%E9%A1%B9",target:"_blank",rel:"noopener noreferrer"},cn={id:"_5、实战应用-单位千米与米的相互转换",tabindex:"-1"},ln=n("a",{class:"header-anchor",href:"#_5、实战应用-单位千米与米的相互转换","aria-hidden":"true"},"#",-1),un={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_5%E3%80%81%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8-%E5%8D%95%E4%BD%8D%E5%8D%83%E7%B1%B3%E4%B8%8E%E7%B1%B3%E7%9A%84%E7%9B%B8%E4%BA%92%E8%BD%AC%E6%8D%A2",target:"_blank",rel:"noopener noreferrer"},kn=p(`<p>实现单位千米与米的转换</p><p><img src="https://www.arryblog.com/assets/img/GIF2023-5-1823-38-48.918f132e.gif" alt="GIF2023-5-1823-38-48"></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> watch <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> kilometers <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 千米</span>
  <span class="token keyword">const</span> meters <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 米</span>
  <span class="token function">watch</span><span class="token punctuation">(</span>kilometers<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;kilometers变化了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    meters<span class="token punctuation">.</span>value <span class="token operator">=</span> newValue <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">watch</span><span class="token punctuation">(</span>meters<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;meters变化了&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    kilometers<span class="token punctuation">.</span>value <span class="token operator">=</span> newValue <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>千米： <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>kilometers<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>米：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>meters<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),rn={id:"_6、停止侦听器",tabindex:"-1"},dn=n("a",{class:"header-anchor",href:"#_6、停止侦听器","aria-hidden":"true"},"#",-1),vn={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_6%E3%80%81%E5%81%9C%E6%AD%A2%E4%BE%A6%E5%90%AC%E5%99%A8",target:"_blank",rel:"noopener noreferrer"},mn=p(`<p>在 <code>setup()</code> 或 <code>&lt;script setup&gt;</code> 中用<strong>同步语句创建的侦听器</strong>，会自动绑定到宿主组件实例上，并且会在宿主组件卸载时自动停止。因此，在大多数情况下，你无需关心怎么停止一个侦听器。</p><p>如果用<strong>异步回调创建一个侦听器</strong>，那么它不会绑定到当前组件上，你必须手动停止它，以防内存泄漏</p><ul><li>同步语句中创建的侦听器，在组件实例被销毁时自动停止</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">watch</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>异步回调创建一个侦听器，在组件实例即将销毁前，手动停止</li></ul><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">let</span> unwatch <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  unwatch <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// ....</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 在组件实例即将销毁前，停止候听器</span>
<span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;组件即将销毁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 停止侦听器</span>
  <span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>代码演示</strong></p><ul><li><code>App.vue</code></li></ul><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> List <span class="token keyword">from</span> <span class="token string">&quot;./components/List.vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> isShow <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShow = false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>卸载List组件<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>List</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>isShow<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>List</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li><code>List.vue</code></li></ul><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> watch<span class="token punctuation">,</span> onBeforeUnmount<span class="token punctuation">,</span> onUnmounted<span class="token punctuation">,</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> count <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> unwatch <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token comment">/* 同步侦听器，在组件销毁时，自动销毁
    watch(count, (newValue, oldValue) =&gt; {
        console.log(\`count的值从\${newValue} ===&gt;\${oldValue}\`)
    })
	*/</span>
  <span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    unwatch <span class="token operator">=</span> <span class="token function">watch</span><span class="token punctuation">(</span>count<span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">newValue<span class="token punctuation">,</span> oldValue</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">count的值从</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>newValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> ===&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>oldValue<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 生命周期函数</span>
  <span class="token function">onBeforeUnmount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;即将销毁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 停止侦听器</span>
    <span class="token function">unwatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    count<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 生命周期函数</span>
  <span class="token function">onUnmounted</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;实例销毁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    count<span class="token punctuation">.</span>value<span class="token operator">++</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>count++<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>更新<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>{{ count }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>以上代码，如果不在生命周期函数<code>onBeforeUnmount</code>中调用<code>unwatch()</code>停止侦听器，组件被卸载后，侦听器依赖没有停止，最终渲染效果如下：</p></blockquote><p><img src="https://www.arryblog.com/assets/img/GIF2023-5-1915-38-47.89195b07.gif" alt="GIF2023-5-1915-38-47"></p><blockquote><p>如果在生命周期函数<code>onBeforeUnmount</code>中调用<code>unwatch()</code>停止侦听器，则最终渲染效果如下：</p></blockquote><p><img src="https://www.arryblog.com/assets/img/GIF2023-5-1915-37-32.4f4ad570.gif" alt="GIF2023-5-1915-37-32"></p>`,15),gn={id:"三、watcheffect-方法",tabindex:"-1"},bn=n("a",{class:"header-anchor",href:"#三、watcheffect-方法","aria-hidden":"true"},"#",-1),hn={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#%E4%B8%89%E3%80%81watcheffect-%E6%96%B9%E6%B3%95",target:"_blank",rel:"noopener noreferrer"},fn=n("p",null,[s("深入浅出 "),n("code",null,"watchEffect()"),s(" 方法的基本使用，侦听器调试，副作用清除，停止侦听器，"),n("code",null,"watch()"),s(" 与 "),n("code",null,"watchEffect()"),s(" 对比，axios 取消请求，实战应用 等。")],-1),wn={id:"_1、watcheffect-的基本使用",tabindex:"-1"},qn=n("a",{class:"header-anchor",href:"#_1、watcheffect-的基本使用","aria-hidden":"true"},"#",-1),An={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_1%E3%80%81watcheffect-%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8",target:"_blank",rel:"noopener noreferrer"},En=p(`<p><code>watchEffect()</code>方法一旦被调用，会立即运行其回调函数，同时响应式地追踪其依赖，并在依赖更改时重新执行。</p><div class="language-typescript line-numbers-mode" data-ext="ts"><pre class="language-typescript"><code><span class="token keyword">function</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span>
  <span class="token function-variable function">effect</span><span class="token operator">:</span> <span class="token punctuation">(</span>onCleanup<span class="token operator">:</span> OnCleanup<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">,</span> <span class="token comment">//  运行副作用函数</span>
  options<span class="token operator">?</span><span class="token operator">:</span> WatchEffectOptions <span class="token comment">// 可选的配置选项</span>
<span class="token punctuation">)</span><span class="token operator">:</span> StopHandle<span class="token punctuation">;</span>

<span class="token keyword">interface</span> <span class="token class-name">WatchEffectOptions</span> <span class="token punctuation">{</span>
  flush<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">&quot;pre&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;post&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;sync&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 默认：&#39;pre&#39;</span>
  onTrack<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> DebuggerEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
  onTrigger<span class="token operator">?</span><span class="token operator">:</span> <span class="token punctuation">(</span>event<span class="token operator">:</span> DebuggerEvent<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">void</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>参数详解</p><ul><li>第一个参数是要运行的副作用函数。这个副作用函数的参数也是一个函数，用来注册清理回调。清理回调会在该副作用下一次执行前被调用，可以用来清理无效的副作用，例如等待中的异步请求</li><li>第二个参数是一个可选的选项，可以用来调整副作用的刷新时机或调试副作用的依赖。 <ul><li><code>flush:&#39;post&#39;</code> 默认情况下，侦听器将在组件渲染之前执行。设置 <code>flush: &#39;post&#39;</code> 将会使侦听器延迟到组件渲染之后再执行</li><li><code>onTrack</code> 将在响应属性或引用作为依赖项被跟踪时被调用。</li><li><code>onTrigger</code> 将在侦听器回调被依赖项的变更触发时被调用。</li></ul></li></ul><p><strong>代码示例</strong></p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">a+b=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>a<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">+</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>b<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>a:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model.number</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>a<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>b:<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">v-model.number</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>以上代码，最终渲染效果如下：</p></blockquote><p><img src="https://www.arryblog.com/assets/img/GIF2023-5-2316-59-59.54ec803a.gif" alt="GIF2023-5-2316-59-59"></p><p>执行结果分析</p><ul><li><code>watchEffect()</code>方法在数据第一次初始化时，就会调用回调函数执行副作用。</li><li>不管 a 的值发生变化，还是 b 的值发生变化，侦听器都能侦听到。他并不需要我们指定侦听的数据源，会自动感知代码的依赖。</li></ul><p><strong>注意</strong>：</p><p><code>watch()</code>方法是惰执行的，只在数据更新时才会执行，即第一次初始化时并不会侦听，除非添加了<code>immediate: true</code>配置。</p>`,12),yn={id:"_2、侦听器调试",tabindex:"-1"},_n=n("a",{class:"header-anchor",href:"#_2、侦听器调试","aria-hidden":"true"},"#",-1),xn={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_2%E3%80%81%E4%BE%A6%E5%90%AC%E5%99%A8%E8%B0%83%E8%AF%95",target:"_blank",rel:"noopener noreferrer"},Cn=p(`<p>如果我们想要对侦听器做调试，可以向 <code>watchEffect()</code> 传入第二个参数，是一个包含了 <code>onTrack</code> 和 <code>onTrigger</code> 两个回调函数的对象。</p><ul><li><code>onTrack</code> 将在响应属性或引用作为依赖项被跟踪时被调用。</li><li><code>onTrigger</code> 将在侦听器回调被依赖项的变更触发时被调用。</li></ul><blockquote><p>侦听器的 <code>onTrack</code> 和 <code>onTrigger</code> 选项仅会在开发模式下工作。</p></blockquote><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref<span class="token punctuation">,</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">watchEffect</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>a<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">+</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>b<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>a<span class="token punctuation">.</span>value <span class="token operator">+</span> b<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      <span class="token function">onTrack</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当读取a和b的值时触发，即： a.value  b.value</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;track&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">debugger</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token function">onTrigger</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 当a和b的值发生变化时触发 即 a.value=20 b.value=20</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;trigger&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">debugger</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>a: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model.number</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>a<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span>b: <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-model.number</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>b<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),Bn={href:"https://cn.vuejs.org/guide/extras/reactivity-in-depth.html#reactivity-debugging",target:"_blank",rel:"noopener noreferrer"},Vn={id:"_3、副作用清除",tabindex:"-1"},jn=n("a",{class:"header-anchor",href:"#_3、副作用清除","aria-hidden":"true"},"#",-1),Tn={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_3%E3%80%81%E5%89%AF%E4%BD%9C%E7%94%A8%E6%B8%85%E9%99%A4",target:"_blank",rel:"noopener noreferrer"},In=p(`<p><code>watchEffect</code>回调函数的第一个参数<code>onCleanup</code>为副作用清除函数，<code>onCleanup</code>函数接收一个函数作为参数，该参数会在下一次回调函数调用前执行。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">onCleanup</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 取消定时器或取消请求等操作</span>
  <span class="token keyword">function</span> <span class="token function">cancle</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

  <span class="token comment">// cancle 函数会在下一次回调函数调用前执行</span>
  <span class="token function">onCleanup</span><span class="token punctuation">(</span>cancle<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),Mn={id:"_4、停止侦听器",tabindex:"-1"},Ln=n("a",{class:"header-anchor",href:"#_4、停止侦听器","aria-hidden":"true"},"#",-1),Sn={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_4%E3%80%81%E5%81%9C%E6%AD%A2%E4%BE%A6%E5%90%AC%E5%99%A8",target:"_blank",rel:"noopener noreferrer"},Jn=p(`<p>停止侦听器的方式和<code>watch</code>方法一样。</p><blockquote><p>具体如下：</p></blockquote><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> stop <span class="token operator">=</span> <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 停止侦听器</span>
<span class="token function">stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,3),Pn={id:"_5、watch-与-watcheffect-对比",tabindex:"-1"},zn=n("a",{class:"header-anchor",href:"#_5、watch-与-watcheffect-对比","aria-hidden":"true"},"#",-1),Nn={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_5%E3%80%81watch-%E4%B8%8E-watcheffect-%E5%AF%B9%E6%AF%94",target:"_blank",rel:"noopener noreferrer"},Gn=p("<p><strong><code>watch()</code>侦听器特点</strong></p><ul><li>默认是懒侦听的，即仅在侦听源发生变化时才执行回调函数，设置<code>immediate: true</code>时可以变为非惰性，页面首次加载就会执行</li><li>需要指定侦听的数据源，并且只在该数据源发生变化时，才会执行</li><li>可以获取数据变化前后的值</li></ul><p><strong><code>watchEffect()</code>侦听器特点</strong></p><ul><li><code>watchEffect()</code> 立即执行，没有惰性，页面首次加载就会执行</li><li><code>watchEffect()</code>不需要指定侦听的数据源，会自动收集依赖数据，依赖数据更新时重新执行自身</li><li>无法获取到变化前的原始值，只能得到变化后的值</li></ul>",4),Dn={id:"_6、axios-取消请求",tabindex:"-1"},Xn=n("a",{class:"header-anchor",href:"#_6、axios-取消请求","aria-hidden":"true"},"#",-1),On={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_6%E3%80%81axios-%E5%8F%96%E6%B6%88%E8%AF%B7%E6%B1%82",target:"_blank",rel:"noopener noreferrer"},Fn=n("p",null,"副作用清理函数常用来取消上一次请求，所以接下来，我们先来学习下如何在 axios 中取消上一次请求。",-1),Hn={href:"https://www.axios-http.cn/docs/cancellation",target:"_blank",rel:"noopener noreferrer"},Rn={href:"https://developer.mozilla.org/zh-CN/docs/Web/API/AbortController",target:"_blank",rel:"noopener noreferrer"},Un=n("code",null,"v0.22.0",-1),Wn={href:"https://developer.mozilla.org/en-US/docs/Web/API/AbortController",target:"_blank",rel:"noopener noreferrer"},Qn=n("code",null,"AbortController",-1),Kn=p(`<div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token comment">// controller表示一个控制器对象，允许你根据需要中止一个或多个 Web 请求。</span>
<span class="token keyword">const</span> controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

axios
  <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/foo/bar&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token comment">// controller的只读属性signal 返回一个 AbortSignal 实例对象，该对象可以根据需要处理 DOM 请求通信，既可以建立通信，也可以终止通信。</span>
    <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span>signal<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">response</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 中止一个尚未完成的 Web（网络）请求</span>
controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>代码示例</strong></p><blockquote><p>当点击发送请求按扭后，会开始发起两个请求，如果请求还没有回来时，点击了取消请求按扭，则会同时把两个请求都取消。</p></blockquote><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 请求地址</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span>
    <span class="token string">&quot;https://www.fastmock.site/mock/6ec78e345df340241e1f5043f0167833/icode/menu/&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 请求ID</span>
  <span class="token keyword">const</span> paramId <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> controller <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">// 发送请求</span>
  <span class="token keyword">function</span> <span class="token function">onSend</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    axios
      <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">+</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>paramId<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span>signal<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求成功内容：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理请求回来的内容</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    axios
      <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">+</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>paramId<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span>signal<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求成功内容：&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 处理请求回来的内容</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">function</span> <span class="token function">onAbort</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 取消请求 （多个请求）</span>
    controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onSend<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>发起请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>onAbort<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>取消请求<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,4),Zn={id:"_7、实战应用",tabindex:"-1"},Yn=n("a",{class:"header-anchor",href:"#_7、实战应用","aria-hidden":"true"},"#",-1),$n={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#_7%E3%80%81%E5%AE%9E%E6%88%98%E5%BA%94%E7%94%A8",target:"_blank",rel:"noopener noreferrer"},ns=p(`<p>以下示例展示了 <code>paramId</code> 变量的数据发生变化时，会发送 Ajax 请求。</p><p>但是在请求数据还没有回来前 <code>paramId</code> 变值的值再次发生变化时，就会把上一次请求取消，然后重新发送一次请求。</p><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> axios <span class="token keyword">from</span> <span class="token string">&quot;axios&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> reactive<span class="token punctuation">,</span> ref<span class="token punctuation">,</span> watch<span class="token punctuation">,</span> watchEffect <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 请求地址</span>
  <span class="token keyword">const</span> url <span class="token operator">=</span>
    <span class="token string">&quot;https://www.fastmock.site/mock/6ec78e345df340241e1f5043f0167833/icode/menu/&quot;</span><span class="token punctuation">;</span>
  <span class="token comment">// 请求参数</span>
  <span class="token keyword">const</span> paramId <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token number">1001</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">// 接受请求回来的数据 (数组)</span>
  <span class="token keyword">const</span> list <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> controller <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>

  <span class="token comment">// 一上来，就发一个请求获取数据</span>
  <span class="token function">watchEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">onCleanup</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// AbortController 接口表示一个控制器对象，允许你根据需要中止一个或多个 Web 请求。</span>
    controller <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AbortController</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 可以发请求</span>
    axios
      <span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>paramId<span class="token punctuation">.</span>value<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
        <span class="token comment">// 配置取消请求</span>
        <span class="token literal-property property">signal</span><span class="token operator">:</span> controller<span class="token punctuation">.</span>signal<span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        list<span class="token punctuation">.</span>value <span class="token operator">=</span> res<span class="token punctuation">.</span>data<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>list<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;请求失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// 取消请求</span>
    <span class="token keyword">function</span> <span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;用户取消请求&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      controller<span class="token punctuation">.</span><span class="token function">abort</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 在下一次执行前，会调用传入的cancle取消上一次请求</span>
    <span class="token function">onCleanup</span><span class="token punctuation">(</span>cancel<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!-- 菜单 --&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paramId = 1001<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>菜单1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span> |
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paramId = 1002<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>菜单2<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span> |
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span> <span class="token attr-name">@click</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>paramId = 1003<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>菜单3<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span> <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item in list<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>item.id<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>{{ item.productName }}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>以上代码最终渲染效果如下：</p></blockquote><p><img src="https://www.arryblog.com/assets/img/GIF2023-7-1423-35-57.be519141.gif" alt="GIF2023-7-1423-35-57"></p><p>注：</p><p>初始渲染时，就会发请求加菜单 1 中的内容，然后渲染成列表显示在页面。</p><p>当我们点击菜单 2 时，在数据没有回来前再点击菜单 3，则菜单 2 的请求被取消，然后发请求获取菜单 3 的内容最终返回的新内容替换原来的内容，渲染成列表显示在页面。</p>`,8),ss={id:"四、自定义指令",tabindex:"-1"},as=n("a",{class:"header-anchor",href:"#四、自定义指令","aria-hidden":"true"},"#",-1),ts={href:"https://www.arryblog.com/vip/vue/composition-api-watch-custom-instructions.html#%E5%9B%9B%E3%80%81%E8%87%AA%E5%AE%9A%E4%B9%89%E6%8C%87%E4%BB%A4",target:"_blank",rel:"noopener noreferrer"},ps=p(`<ul><li>在全局注册的自定义指令，在任意组件的模板中可以直接使用。</li><li>在<code>&lt;script setup&gt;</code>中不需要显式注册局部指令，如果一个变量的命名遵循<code>vNameOfDirective</code>这样的规范，Vue 会自动把他当作一条指令来执行。</li></ul><blockquote><p>指令的值和用法与选项式 API 中一模一样，具体可参考选项式 API</p></blockquote><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token comment">// 定义一条指令 v-my-directive  ,以下是对象的完整写法</span>
  <span class="token keyword">const</span> vMyDirective <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">updated</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 定义一条指令v-focus,以下是函数简写形式</span>
  <span class="token keyword">const</span> <span class="token function-variable function">vFocus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token comment">&lt;!--使用指令--&gt;</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-my-directive</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-focus</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果指令是从别处导入的，可以通过重命名来使期符合命名规范</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> focus <span class="token keyword">as</span> vFocus <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;./focus.js&quot;</span><span class="token punctuation">;</span>

<span class="token comment">// focus.js内容如下</span>
<span class="token keyword">const</span> <span class="token function-variable function">focus</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">/* ...... */</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">export</span> <span class="token punctuation">{</span> focus <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>代码示例</strong></p><blockquote><p>自定义<code>v-focus</code>指令，单行文本框在添加该指令后，会自获取焦点同时背景色变蓝色。</p></blockquote><div class="language-html line-numbers-mode" data-ext="html"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">setup</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">import</span> <span class="token punctuation">{</span> ref <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;vue&quot;</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token function">ref</span><span class="token punctuation">(</span><span class="token string">&quot;Hello&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> vFocus <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token function">mounted</span><span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      el<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>border <span class="token operator">=</span> <span class="token string">&quot;none&quot;</span><span class="token punctuation">;</span>
      el<span class="token punctuation">.</span>style<span class="token punctuation">.</span>backgroundColor <span class="token operator">=</span> <span class="token string">&quot;skyblue&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token comment">// 以下是函数简写形式,当 mounted 与 updated 效果一样时，可采用函数简写形式</span>
  <span class="token comment">/*
    const vFocus = (el, binding) =&gt; {
      el.focus();
      el.style.border = &quot;none&quot;;
      el.style.backgroundColor = &quot;skyblue&quot;
    }
	*/</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-focus</span> <span class="token attr-name">v-model</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,8);function os(es,cs){const a=e("ExternalLinkIcon");return c(),l("div",null,[i,k,r,n("h2",d,[v,s(),n("a",m,[s("#"),t(a)]),s("一、"),g]),b,h,n("h3",f,[w,s(),n("a",q,[s("#"),t(a)]),s("1、"),A,s("的基本用法")]),E,n("h3",y,[_,s(),n("a",x,[s("#"),t(a)]),s("2、响应式数据")]),C,n("h3",B,[V,s(),n("a",j,[s("#"),t(a)]),s("3、使用组件")]),T,n("h3",I,[M,s(),n("a",L,[s("#"),t(a)]),s("4、动态组件")]),S,n("h3",J,[P,s(),n("a",z,[s("#"),t(a)]),s("5、计算属性 computed")]),N,n("h2",G,[D,s(),n("a",X,[s("#"),t(a)]),s("二、侦听器 watch")]),O,n("h3",F,[H,s(),n("a",R,[s("#"),t(a)]),s("1、watch 方法的基本使用")]),U,n("h3",W,[Q,s(),n("a",K,[s("#"),t(a)]),s("2、侦听数据源")]),Z,n("h3",Y,[$,s(),n("a",nn,[s("#"),t(a)]),s("3、副作用清理")]),sn,n("h3",an,[tn,s(),n("a",pn,[s("#"),t(a)]),s("4、options 配置项")]),on,n("blockquote",null,[n("p",null,[s("具体用法可以参考选项式 API："),n("a",en,[s("侦听器配置选项(opens new window)"),t(a)])])]),n("h3",cn,[ln,s(),n("a",un,[s("#"),t(a)]),s("5、实战应用：单位千米与米的相互转换")]),kn,n("h3",rn,[dn,s(),n("a",vn,[s("#"),t(a)]),s("6、停止侦听器")]),mn,n("h2",gn,[bn,s(),n("a",hn,[s("#"),t(a)]),s("三、watchEffect() 方法")]),fn,n("h3",wn,[qn,s(),n("a",An,[s("#"),t(a)]),s("1、watchEffect() 的基本使用")]),En,n("h3",yn,[_n,s(),n("a",xn,[s("#"),t(a)]),s("2、侦听器调试")]),Cn,n("blockquote",null,[n("p",null,[s("更多响应性调试，查阅 Vue 官方文档："),n("a",Bn,[s("响应性调试(opens new window)"),t(a)])])]),n("h3",Vn,[jn,s(),n("a",Tn,[s("#"),t(a)]),s("3、副作用清除")]),In,n("h3",Mn,[Ln,s(),n("a",Sn,[s("#"),t(a)]),s("4、停止侦听器")]),Jn,n("h3",Pn,[zn,s(),n("a",Nn,[s("#"),t(a)]),s("5、watch() 与 watchEffect() 对比")]),Gn,n("h3",Dn,[Xn,s(),n("a",On,[s("#"),t(a)]),s("6、axios 取消请求")]),Fn,n("blockquote",null,[n("p",null,[s("在 axios 中取消上一次请求相关代码，具体参考："),n("a",Hn,[s("axios 取消请求 (opens new window)"),t(a)]),s("与 "),n("a",Rn,[s("AbortController - Web API 接口参考 | MDN (mozilla.org)(opens new window)"),t(a)])])]),n("p",null,[s("从 "),Un,s(" 开始，Axios 支持以 fetch API 方式 —— "),n("a",Wn,[Qn,s(" (opens new window)"),t(a)]),s("取消请求，该请求一旦被取消将不能被再发起。")]),Kn,n("h3",Zn,[Yn,s(),n("a",$n,[s("#"),t(a)]),s("7、实战应用")]),ns,n("h2",ss,[as,s(),n("a",ts,[s("#"),t(a)]),s("四、自定义指令")]),ps])}const us=o(u,[["render",os],["__file","Vue zuheshi API - watch he watchEffect、zidingyizhiling.html.vue"]]);export{us as default};
