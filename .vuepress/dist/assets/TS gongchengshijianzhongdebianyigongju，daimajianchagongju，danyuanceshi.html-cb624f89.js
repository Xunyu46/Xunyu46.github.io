import{_ as p,r as l,o,c as i,a as n,b as s,e as t,d as a}from"./app-7ac1ad86.js";const c={},d=a('<h1 id="ts-工程实践中的编译工具-代码检查工具-单元测试" tabindex="-1"><a class="header-anchor" href="#ts-工程实践中的编译工具-代码检查工具-单元测试" aria-hidden="true">#</a> TS 工程实践中的编译工具，代码检查工具，单元测试</h1><p>TIP</p><p>从本节开始学习 TypeScript 工程实践中的编译工具，代码检查工具 TSLint 和 ESLint，Jest 单元测试，TS 工程实践知识总结相关内容。</p><h2 id="一、ts-编译工具" tabindex="-1"><a class="header-anchor" href="#一、ts-编译工具" aria-hidden="true">#</a> 一、TS 编译工具</h2><p>TIP</p><p>前面我们用 Webpack 构建了 TS 的基础环境，并编写了 <code>Hello World</code> 程序。为了能将 TypeScript 编译成 JavaScript 我们用了一个 Webpack 的 loader ，即 <code>ts-loader</code> 。</p><blockquote><p>接下来我们来详细解读 <code>ts-loader</code> 的细节</p></blockquote><h3 id="_1、解读-ts-loader" tabindex="-1"><a class="header-anchor" href="#_1、解读-ts-loader" aria-hidden="true">#</a> 1、解读 ts-loader</h3><p>TIP</p><p>在 <code>webpack.base.config.js</code> 基础（公共）环境配置中</p><blockquote><p>从 <code>ts-loader</code> 源码中可以看到，它在内部调用了 TS 官方的编译器，即 <code>tsc</code></p></blockquote><p><img src="https://www.arryblog.com/assets/img/image-20230927001348015.13127203.png" alt="image-20230927001348015"></p><p>注：</p>',13),r=n("li",null,[s("所以，"),n("code",null,"ts-loader"),s(" 和 "),n("code",null,"tsc"),s(" 是共享 "),n("code",null,"tsconfig.json"),s(" 配置文件的")],-1),u=n("code",null,"ts-loader",-1),k=n("code",null,"options",-1),m={href:"https://github.com/TypeStrong/ts-loader",target:"_blank",rel:"noopener noreferrer"},b=a(`<h3 id="_2、ts-loader-中的-options-属性" tabindex="-1"><a class="header-anchor" href="#_2、ts-loader-中的-options-属性" aria-hidden="true">#</a> 2、ts-loader 中的 options 属性</h3><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 入口文件</span>
  <span class="token literal-property property">entry</span><span class="token operator">:</span> <span class="token string">&quot;./src/index.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 输出文件</span>
  <span class="token literal-property property">output</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">filename</span><span class="token operator">:</span> <span class="token string">&quot;app.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 指定扩展名</span>
  <span class="token literal-property property">resolve</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">extensions</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.tsx&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ts-leader</span>
  <span class="token literal-property property">module</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token literal-property property">rules</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// ts-loader 的正则，以 ts 或 tsx 结尾的文件</span>
        <span class="token literal-property property">test</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.tsx?$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        <span class="token literal-property property">use</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;ts-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token comment">// ---------------------------------------------</span>
            <span class="token comment">// ts-loader 自己的配置，通过 options 属性传入</span>
            <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token comment">// 作用：当该配置项开启后会告诉编译器只做语言转换，而不去做类型检查</span>
              <span class="token comment">// 因为在实际项目中，随着项目越来越大，构建时间越来越长。原因之一是 TS 编译器要做很多事情，不仅要做语言转换也要做类型检查</span>
              <span class="token comment">// 开启该配置项，就会启动一种快速构建的模式，设为 false 就是将其关闭</span>
              <span class="token comment">// 默认值为 false，现在来观察构建速度</span>
              <span class="token literal-property property">transpileOnly</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 排除 node_modules 下的文件</span>
        <span class="token literal-property property">exclude</span><span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 插件</span>
  <span class="token literal-property property">plugins</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      <span class="token literal-property property">template</span><span class="token operator">:</span> <span class="token string">&quot;./src/tpl/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在控制台中，通过命令行进行重新构建</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>观察构建时间为 <code>2023 ms</code></p><p><img src="https://www.arryblog.com/assets/img/image-20230927190906176.29f7c034.png" alt="image-20230927190906176"></p><p>再次修改配置文件中 <code>transpileOnly: true</code></p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token punctuation">{</span>
    <span class="token literal-property property">loader</span><span class="token operator">:</span> <span class="token string">&quot;ts-loader&quot;</span><span class="token punctuation">,</span>
	    <span class="token comment">// 修改  transpileOnly: true 开启</span>
        <span class="token literal-property property">options</span><span class="token operator">:</span> <span class="token punctuation">{</span>
            <span class="token literal-property property">transpileOnly</span><span class="token operator">:</span> <span class="token boolean">true</span>
        <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在控制台中，通过命令行进行重新构建</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>再次观察构建时间为 <code>820 ms</code> ，相比配置选项为 <code>transpileOnly: false</code> 时，已经节约了很多的构建时间</p><p><img src="https://www.arryblog.com/assets/img/image-20230927191729760.52e22e29.png" alt="image-20230927191729760"></p><blockquote><p>以上方式已经节约了很多构建时间（速度更快了），但该模式有一个缺点，即：在编译时不能进行类型检查</p></blockquote><p>在 <code>src/index.ts</code> 中</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token keyword">let</span> hello<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&quot;Hello TypeScript ! arry老师&quot;</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将以上字符串插入到网页中</span>
document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> hello<span class="token punctuation">;</span>

<span class="token comment">// 在此写下一个明显的错误</span>
hello <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/image-20230927192849059.8ab97ab5.png" alt="image-20230927192849059"></p><blockquote><p>此时，IDE 开发工具会报错 ！但 TS 比较柔性的地方在于：即使 IDE 报错，也不会阻止程序的编译</p></blockquote><p>在控制台中，通过命令行进行重新编译构建</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/image-20230927194552401.6287d0ed.png" alt="image-20230927194552401"></p><blockquote><p>此时，可以看到编译仍然是通过了 ！</p></blockquote><h3 id="_3、fork-ts-checker-webpack-plugin-插件" tabindex="-1"><a class="header-anchor" href="#_3、fork-ts-checker-webpack-plugin-插件" aria-hidden="true">#</a> 3、fork-ts-checker-webpack-plugin 插件</h3><p>TIP</p><p>如何在 <code>transpileOnly: true</code> 开启的状态下，又可以进行类型检查呢 ？</p><p>这时，我们需要借助一个插件来实现，它会将类型检查放在一个独立的进程中进行。</p><blockquote><p>安装如下</p></blockquote><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i fork-ts-checker-webpack-plugin <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><blockquote><p>以上插件安装完成后，然后在配置文件中引入进来 ！</p></blockquote><p>在 <code>webpack.base.config.js</code> 配置文件中</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 导入插件依赖</span>
<span class="token keyword">const</span> ForkTsCheckerWebpackPlugin <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;fork-ts-checker-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> HtmlWebpackPlugin <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;html-webpack-plugin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 入口文件</span>
  entry<span class="token operator">:</span> <span class="token string">&quot;./src/index.ts&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 输出文件</span>
  output<span class="token operator">:</span> <span class="token punctuation">{</span>
    filename<span class="token operator">:</span> <span class="token string">&quot;app.js&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 指定扩展名</span>
  resolve<span class="token operator">:</span> <span class="token punctuation">{</span>
    extensions<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;.js&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.ts&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;.tsx&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ts-leader</span>
  module<span class="token operator">:</span> <span class="token punctuation">{</span>
    rules<span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        <span class="token comment">// ts-loader 的正则，以 ts 或 tsx 结尾的文件</span>
        test<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\\.tsx?$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">,</span>
        use<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token punctuation">{</span>
            loader<span class="token operator">:</span> <span class="token string">&quot;ts-loader&quot;</span><span class="token punctuation">,</span>
            <span class="token comment">// ---------------------------------------------</span>
            <span class="token comment">// ts-loader 自己的配置，通过 options 属性传入</span>
            options<span class="token operator">:</span> <span class="token punctuation">{</span>
              <span class="token comment">// 作用：当该配置项开启后会告诉编译器只做语言转换，而不去做类型检查</span>
              <span class="token comment">// 因为在实际项目中，随着项目越来越大，构建时间越来越长。原因之一是 TS 编译器要做很多事情，不仅要做语言转换也要做类型检查</span>
              <span class="token comment">// 开启该配置项，就会启动一种快速构建的模式，设为 false 就是将其关闭</span>
              <span class="token comment">// 默认值为 false，现在来观察构建速度</span>
              transpileOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 排除 node_modules 下的文件</span>
        exclude<span class="token operator">:</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">node_modules</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 插件</span>
  plugins<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token keyword">new</span> <span class="token class-name">HtmlWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      template<span class="token operator">:</span> <span class="token string">&quot;./src/tpl/index.html&quot;</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// ---------直接 new 即可-----------</span>
    <span class="token keyword">new</span> <span class="token class-name">ForkTsCheckerWebpackPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在终端重新构建，输入如下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/image-20230930180841125.a510628d.png" alt="image-20230930180841125"></p><blockquote><p>以上构建过程中会报错，提示 <code>src/index.ts</code> 语句中有错误 ！“不能将 1 赋值给 字符串类型”</p></blockquote><p>在 <code>src/index.ts</code> 中</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 导入</span>
<span class="token keyword">import</span> <span class="token string">&quot;./libs/index&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> hello<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&quot;Hello TypeScript ! arry老师&quot;</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将以上字符串插入到网页中</span>
document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> hello<span class="token punctuation">;</span>

<span class="token comment">// 在此写下一个明显的错误</span>
<span class="token comment">// --------将以下代码注释掉，构建就能通过--------</span>
<span class="token comment">// hello = 1;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将以上错误代码注释掉后，构建就能通过了 ，不再报错</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>注：</p><p>以上就是 <code>ts-loader</code> 中 <code>transpileOnly</code> 配置项的用法</p><ul><li>在关闭的情况下，可以提高构建速度；</li><li>在开启的情况下，它会失去类型检查。我们需要额外的插件来进行工作，以上使用的是 <code>fork-ts-checker-webpack-plugin</code> 插件</li></ul><h3 id="_4、awesome-typescript-loader" tabindex="-1"><a class="header-anchor" href="#_4、awesome-typescript-loader" aria-hidden="true">#</a> 4、awesome-typescript-loader</h3><p>TIP</p>`,43),v=n("code",null,"ts-loader",-1),g={href:"https://www.npmjs.com/package/awesome-typescript-loader",target:"_blank",rel:"noopener noreferrer"},h=a(`<p><code>awesome-typescript-loader</code> 与 <code>ts-loader</code> 的主要区别</p><ul><li>①、更适合与 Babel 集成，使用 Babel 的转义 和 缓存</li><li>②、不需要安装额外的插件，就可以把类型检查放在独立进程中进行</li></ul><p><strong>编译时间对比（ms）</strong></p><table><thead><tr><th style="text-align:left;">loader</th><th style="text-align:left;">默认设置</th><th style="text-align:left;">transpileOnly</th><th style="text-align:left;">transpileOnly + 类型检查进程</th></tr></thead><tbody><tr><td style="text-align:left;">ts-loader</td><td style="text-align:left;">1600+</td><td style="text-align:left;">500+</td><td style="text-align:left;">3000+（时间较长）</td></tr><tr><td style="text-align:left;">awesome-typescript-loader</td><td style="text-align:left;">2200+</td><td style="text-align:left;">1600+</td><td style="text-align:left;">1600+（类型检查有遗漏）</td></tr></tbody></table><p>TIP</p><p>以上两个 loader 在开启 <code>transpileOnly</code> 的情况下，构建时间都有明显的缩短。但在加入类型检查进程时，<code>ts-loader</code> 的构建时间反而比较长。</p><p>而 <code>awesome-typescript-loader</code> 是有一些缺陷的，如以上有明显的类型赋值错误 <code>hello = 1;</code> 但它无法检测出来。</p><blockquote><p>综合对比下来，还是建议使用 <code>ts-loader</code> 默认的配置即可。</p></blockquote><p>注：</p><p>这个 npm 包好久不更新了，而且类型检查的时候会有遗漏，所以不推荐使用</p><h3 id="_5、typescript-与-babel" tabindex="-1"><a class="header-anchor" href="#_5、typescript-与-babel" aria-hidden="true">#</a> 5、TypeScript 与 Babel</h3><p>TIP</p><p>我们肯定会有一个疑问：使用了 TypeScript，为什么还需要 Babel ？</p><table><thead><tr><th style="text-align:left;">编译器</th><th style="text-align:left;">编译能力</th><th style="text-align:left;">类型检查</th><th style="text-align:left;">插件</th></tr></thead><tbody><tr><td style="text-align:left;">TSC</td><td style="text-align:left;">ts(x)、js(x) -&gt; ES3/5/6/ ...</td><td style="text-align:left;">有</td><td style="text-align:left;">无</td></tr><tr><td style="text-align:left;">Babel</td><td style="text-align:left;">ts(x)、js(x) -&gt; ES3/5/6/ ...</td><td style="text-align:left;">无</td><td style="text-align:left;">非常丰富</td></tr></tbody></table><p>对比说明</p><ul><li>从编译能力看：TSC 和 Babel 都可以将 TS 和 JS 编译成 ES3/5/6/ ... 更高级的版本</li><li>类型检查：Babel 没有检查能力，TSC 有</li><li>插件：围绕 Babel 社区提供了非常丰富的生态插件，周边生态系统也非常的完善，而 TSC 非常欠缺</li><li>Babel 7 之前是不支持 TS 的，对于那些已经使用了 Babel 的项目如果想要使用 TS ，并不是一件容易的事情。需要结合前面介绍的 Webpack Loader 经过 loader 的转义 -&gt; 转成 JS -&gt; 再交给 Babel 处理，这是一件非常痛苦的事情。过程如下</li></ul><blockquote><p>TS -&gt; tsc（ts-loader / awesome-typescript-loader） -&gt; JS -&gt; Babel -&gt; JS</p></blockquote><ul><li>Babel 7 之后：已经支持 TS ，是与 TS 官方合作开发的，具有正统的官方血统 ！这时我们就不需要各种 loader 了。甚至在编译时抛弃了 TypeScript 让他去做唯一 Babel 不能去做的事情，即：类型检查。</li></ul><blockquote><p>过程如下</p></blockquote><p><img src="https://www.arryblog.com/assets/img/image-20231003143616007.7b63d791.png" alt="image-20231003143616007"></p><p>其实，我们确实完全没有必要同时来配置两个编译器，可以让各种工具都有 Babel 的生态系统来支持。这样也会让我们的构建系统更加统一、更加可维护。</p><blockquote><p>接下来，我们就使用 Babel 来重新创建一个项目工程</p></blockquote><h3 id="_6、使用-babel-创建工程" tabindex="-1"><a class="header-anchor" href="#_6、使用-babel-创建工程" aria-hidden="true">#</a> 6、使用 Babel 创建工程</h3><p>TIP</p><p>新建一个项目，文件夹名称为 <code>ts-babel</code></p><h3 id="_6-1、使用-npm-命令初始化工程" tabindex="-1"><a class="header-anchor" href="#_6-1、使用-npm-命令初始化工程" aria-hidden="true">#</a> 6.1、使用 npm 命令初始化工程</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment"># npm 初始化生成 package.json 配置文件</span>
<span class="token function">npm</span> init <span class="token parameter variable">-y</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_6-2、安装-babel-相关的依赖" tabindex="-1"><a class="header-anchor" href="#_6-2、安装-babel-相关的依赖" aria-hidden="true">#</a> 6.2、安装 Babel 相关的依赖</h3><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code>npm i <span class="token decorator"><span class="token at operator">@</span><span class="token function">babel</span></span><span class="token operator">/</span>cli <span class="token operator">-</span><span class="token constant">D</span>
npm i <span class="token decorator"><span class="token at operator">@</span><span class="token function">babel</span></span><span class="token operator">/</span>core <span class="token operator">-</span><span class="token constant">D</span>
npm i <span class="token decorator"><span class="token at operator">@</span><span class="token function">babel</span></span><span class="token operator">/</span>plugin<span class="token operator">-</span>proposal<span class="token operator">-</span><span class="token keyword">class</span><span class="token operator">-</span>properties <span class="token operator">-</span><span class="token constant">D</span>
npm i <span class="token decorator"><span class="token at operator">@</span><span class="token function">babel</span></span><span class="token operator">/</span>plugin<span class="token operator">-</span>proposal<span class="token operator">-</span>object<span class="token operator">-</span>rest<span class="token operator">-</span>spread <span class="token operator">-</span><span class="token constant">D</span>
npm i <span class="token decorator"><span class="token at operator">@</span><span class="token function">babel</span></span><span class="token operator">/</span>preset<span class="token operator">-</span>env <span class="token operator">-</span><span class="token constant">D</span>
npm i <span class="token decorator"><span class="token at operator">@</span><span class="token function">babel</span></span><span class="token operator">/</span>preset<span class="token operator">-</span>typescript <span class="token operator">-</span><span class="token constant">D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以上依赖中</p><ul><li><code>@babel/cli</code>、<code>@babel/core</code>、<code>@babel/preset-env</code> 是使用 Babel 必须的</li><li><code>@babel/preset-typescript</code> 用来编译 TS 文件</li><li><code>@babel/plugin-proposal-object-rest-spread</code> 插件，用来支持剩余 和 扩展运算符</li><li><code>@babel/plugin-proposal-class-properties</code> 插件，用来支持使用类的属性初始化器在类的定义中直接给属性赋值</li></ul><h3 id="_6-3、babel-配置文件" tabindex="-1"><a class="header-anchor" href="#_6-3、babel-配置文件" aria-hidden="true">#</a> 6.3、Babel 配置文件</h3><p>在 Babel 的配置文件 <code>.babelrc</code> 中</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;presets&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@babel/env&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;@babel/preset-typescript&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token string">&quot;@babel/proposal-class-properties&quot;</span><span class="token punctuation">,</span>
    <span class="token string">&quot;@babel/proposal-object-rest-spread&quot;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>以上将两个 presets 和 plugins 都引入进来 ！</p></blockquote><h3 id="_6-4、编写文件并完成编译" tabindex="-1"><a class="header-anchor" href="#_6-4、编写文件并完成编译" aria-hidden="true">#</a> 6.4、编写文件并完成编译</h3><p>新建文件 <code>src/index.ts</code></p><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>ts-babel
├─ node_modules
├─ .babelrc
├─ .gitignore
├─ package-lock.json
├─ package.json
└─ src
└─ index.ts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>src/index.ts</code> 文件中</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 定义一个类</span>
<span class="token keyword">class</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 解构赋值</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>z <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 扩展运算符</span>
<span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>z <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写编译脚本，在 <code>package.json</code> 中</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel src --out-dir dist --extensions \\&quot;.ts,.tsx\\&quot;&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 脚本中调用了 babel 命令，指定了输出目录，babel 是不能自动识别 .ts ，.tsx 文件，我们需要指定扩展名</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在控制台中执行构建命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>构建成功，整个过程就是一个最简单的 Babel + TS 的工程配置</p><p><img src="https://www.arryblog.com/assets/img/image-20231001175457739.1bb99a27.png" alt="image-20231001175457739"></p><p>注：</p><p>整个过程我们并没有安装 TypeScript ，而是完全使用 Babel 作为编译工具编译了 TS 文件。通过前面的学习我们知道 Babel 是不能进行类型检查的。</p><blockquote><p>如下测试，在 <code>src/index.ts</code> 中故意设置错误代码</p></blockquote><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 定义一个类</span>
<span class="token keyword">class</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 解构赋值</span>
<span class="token keyword">let</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>z <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span> y<span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span> a<span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token number">4</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// 扩展运算符</span>
<span class="token keyword">let</span> n <span class="token operator">=</span> <span class="token punctuation">{</span> x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">...</span>z <span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// 在此故意写下一个明显的错误</span>
n <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再次使用 Babel 构建</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run build
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/image-20231001180907923.39b525b3.png" alt="image-20231001180907923"></p><p>在代码中有明显的错误代码时，同样也是编译成功了 ！并没有给出任何的错误提示。那么，如果我们想要引入类型检查该怎么办呢 ？</p><blockquote><p>答案是：只能再次安装 TypeScript</p></blockquote><h3 id="_6-5、安装-typescript" tabindex="-1"><a class="header-anchor" href="#_6-5、安装-typescript" aria-hidden="true">#</a> 6.5、安装 TypeScript</h3><p>在命令行终端中输入</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i typescript <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>新建 <code>tsconfig.json</code> 配置文件</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>tsc <span class="token parameter variable">--init</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在 <code>tsconfig.json</code> 配置文件中开启 <code>&quot;noEmit&quot;: true</code> 选项</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;compilerOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;noEmit&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 开始该选项表示 TS 不会输出任何文件只会做类型检查（不生成编译产物，只进行类型检查）</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再在 <code>package.json</code> 中，添加类型检查脚本</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;build&quot;</span><span class="token operator">:</span> <span class="token string">&quot;babel src --out-dir dist --extensions \\&quot;.ts,.tsx\\&quot;&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;type-check&quot;</span><span class="token operator">:</span> <span class="token string">&quot;tsc --watch&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行类型检查脚本，需要重新开一个命令行终端（独占一个终端），在执行如下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run type-check
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/image-20231001233133273.0ce3e25e.png" alt="image-20231001233133273"></p><blockquote><p>此时，就会实时监控编码中的类型错误 ！</p></blockquote><p>将 <code>src/index.ts</code> 中的错误代码注释掉，命令行终端已经提示没有错误。</p><p><img src="https://www.arryblog.com/assets/img/image-20231001235018931.bddad4c0.png" alt="image-20231001235018931"></p><p>注：</p><p>这样就将 TS 和 Babel 结合在一起了</p><ul><li>Babel 只做语言转换</li><li>TS 只做类型检查</li></ul><h3 id="_6-6、在-babel-中使用-ts-注意事项" tabindex="-1"><a class="header-anchor" href="#_6-6、在-babel-中使用-ts-注意事项" aria-hidden="true">#</a> 6.6、在 Babel 中使用 TS 注意事项</h3><p>TIP</p><p>有四种语法在 Babel 中是无法编译的</p><ul><li>①、命名空间，在 Babel 中编译会报错，已经过时了。即：Namespace 语法不推荐，改用标准的 ES6 module（import/export）</li></ul><p>在 <code>src/index.ts</code> 中</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 命名空间</span>
<span class="token keyword">namespace</span> <span class="token constant">N</span> <span class="token punctuation">{</span>
  <span class="token comment">// 导出一个常量</span>
  <span class="token keyword">export</span> <span class="token keyword">const</span> n <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/image-20231002134656126.296587c0.png" alt="image-20231002134656126"></p><ul><li>②、类型断言的语法</li></ul><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 定义一个类</span>
<span class="token keyword">class</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token punctuation">{</span>
  a<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 声明对象 s</span>
<span class="token keyword">let</span> s <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">as</span> <span class="token constant">A</span><span class="token punctuation">;</span>
<span class="token comment">// 给 s 绑定 a 属性，此时 a 是没有定义的，可以给它断言成 class 类型（使用以上的 as 语法）</span>
s<span class="token punctuation">.</span>a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>③、const 常量枚举，在 Babel 中也会编译报错</li></ul><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 常量枚举，在 Babel 中也会编译报错</span>
<span class="token keyword">const</span> <span class="token keyword">enum</span> <span class="token constant">E</span> <span class="token punctuation">{</span>
  <span class="token constant">A</span><span class="token punctuation">,</span>
  <span class="token constant">B</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>④、export 默认导出，在 Babel 中也会编译报错</li></ul><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token keyword">export</span> <span class="token operator">=</span> s<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_7、如何选择-typescript-编译工具" tabindex="-1"><a class="header-anchor" href="#_7、如何选择-typescript-编译工具" aria-hidden="true">#</a> 7、如何选择 TypeScript 编译工具</h3><p>TIP</p><p>有三点建议：</p><ul><li>①、如果没有使用过 Babel，首选 TypeScript 自身的编译器（可配合 <code>ts-loader</code> 使用）</li><li>②、如果项目中已经使用了 Babel，安装 <code>@bable/preset typescript</code>（可配合 tsc 做类型检查）</li><li>③、两种编译工具不要混用，这样只会增加工程的复杂度</li></ul><h2 id="二、代码检查工具-tslint-和-eslint" tabindex="-1"><a class="header-anchor" href="#二、代码检查工具-tslint-和-eslint" aria-hidden="true">#</a> 二、代码检查工具 TSLint 和 ESLint</h2><p>TIP</p><p>深入浅出代码检查工具的来龙去脉以及相关应用，Jest 工具的使用，babel-jest 工具的使用等。</p><h3 id="_1、tslint-转向-eslint-的原因" tabindex="-1"><a class="header-anchor" href="#_1、tslint-转向-eslint-的原因" aria-hidden="true">#</a> 1、TSLint 转向 ESLint 的原因</h3><p>TIP</p><p>TypeScript 官方转向从 TSLint 转向 ESLint 的原因：</p><ul><li>①、TSLint 执行规则的方式存在一些架构问题，从而影响了性能,而修复这些问题会破坏现有的规则;</li><li>②、ESLint 的性能更好，并且社区用户通常拥有 ESLint 的规则配置（比如针对 React 和 Vue 的规则），而不会拥有 TSLint 的规则配置。</li></ul><p>这个决定受到了社区的广泛欢迎，毕竟大家都不想学习那么多的工具，掌握一个好用的就可以了。既然官方已经给出了方向，那我们就不把 TSLint 作为学习的方向了。重点掌握 ESLint 在 TS 中的应用即可 ！</p><h3 id="_2、使用了-typescript-为什么还需要-eslint" tabindex="-1"><a class="header-anchor" href="#_2、使用了-typescript-为什么还需要-eslint" aria-hidden="true">#</a> 2、使用了 TypeScript，为什么还需要 ESLint ？</h3><p>TIP</p><p>从前面的学习中我们知道，TS 主要做两件事情：类型检查 和 语言转换，在这个过程中也会对语法错误进行检查。</p><p>而 ESLint 除了能够检查语法错误 还能 保证代码风格的统一，如：语句后面是不是要加上分号 <code>;</code> 。两者的功能有一些重合，但也各自有它独特的职责。</p><p><img src="https://www.arryblog.com/assets/img/image-20231003145953370.7587d3aa.png" alt="image-20231003145953370"></p><p>但，如果要 ESLint 去检查 TS 的语法就会面临一些问题，它们在进行各自的工作之前都需要把代码转换成抽象语法树，即：AST 。而这两种语法树是不兼容的（如下图）</p><p>相反，TSLint 是完全基于 TS 的抽象语法树工作，这样的好处是没有兼容性问题，缺点是不能重用。这是目前社区已经围绕 ESLint 所做的工作了。这也是官方放弃 TSLint 的原因之一 ！</p><p>如何解决解决这种兼容性问题呢 ？我们需要使用一种 <code>typescript-eslint</code> 的项目，这个项目也是有官方血统的，所以我们可以放心的使用。它为 ESLint 专门提供了解析 TS 代码的编译器，可以把 TS 的语法树转换成 ESLint 所期望的语法树，即：ESTree</p><p><img src="https://www.arryblog.com/assets/img/image-20231003151810580.e7091938.png" alt="image-20231003151810580"></p><h3 id="_3、如何在-ts-中使用-eslint" tabindex="-1"><a class="header-anchor" href="#_3、如何在-ts-中使用-eslint" aria-hidden="true">#</a> 3、如何在 TS 中使用 ESLint</h3><p>TIP</p><p>基于前面的 hello world 工程进行改造</p><blockquote><p>项目目录如下</p></blockquote><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>icoding-ts
├─ .eslintrc.json
├─ .gitignore
├─ build
│ ├─ webpack.base.config.js
│ ├─ webpack.config.js
│ ├─ webpack.dev.config.js
│ └─ webpack.pro.config.js
├─ package-lock.json
├─ package.json
├─ README.md
├─ src
│ ├─ index.ts
│ └─ tpl
│ └─ index.html
└─ tsconfig.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装 eslint 相关的依赖包</p><ul><li><code>eslint</code></li><li><code>@typescript-eslint/eslint-plugin</code> 插件，可使 ESLint 识别 TS 的特殊语法</li><li><code>@typescript-eslint/parser</code> 插件为 ESLint 提供解析器</li></ul><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i eslint @typescript-eslint/eslint-plugin @typescript-eslint/parser <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4、eslint-配置" tabindex="-1"><a class="header-anchor" href="#_4、eslint-配置" aria-hidden="true">#</a> 4、ESLint 配置</h3><p>在 <code>.eslintrc.json</code> 中</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// 指定 ESLint 解析器</span>
  <span class="token property">&quot;parser&quot;</span><span class="token operator">:</span> <span class="token string">&quot;@typescript-eslint/parser&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 指定 ESLint 识别 TS 的特殊语法的插件</span>
  <span class="token property">&quot;plugins&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;@typescript-eslint&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token comment">// 指定 tsconfig 中的类型规则信息</span>
  <span class="token property">&quot;parserOptions&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;project&quot;</span><span class="token operator">:</span> <span class="token string">&quot;./tsconfig.json&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// 具体规则为官方推荐的 recommended 规则，会默认指定一些规则</span>
  <span class="token property">&quot;extends&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;plugin:@typescript-eslint/recommended&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>package.json</code> 中，添加 lint 脚本</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;lint&quot;</span><span class="token operator">:</span> <span class="token string">&quot;eslint src --ext .js,.ts&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 该脚本会自动检查 .js 和 .ts 文件</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在命令行终端中执行该脚本</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run lint
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/image-20231002213112122.4ea0e193.png" alt="image-20231002213112122"></p><blockquote><p>运行报错，由于 <code>src/index.ts</code> 中的变量 hello 从未使用过，建议使用 const 定义</p></blockquote><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// let hello: string = &quot;Hello TypeScript ! arry老师&quot;;</span>

<span class="token comment">// 将 let 改为 const</span>
<span class="token keyword">const</span> hello<span class="token operator">:</span> <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token string">&quot;Hello TypeScript ! arry老师&quot;</span><span class="token punctuation">;</span>
<span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>hello<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 将以上字符串插入到网页中</span>
document<span class="token punctuation">.</span><span class="token function">querySelectorAll</span><span class="token punctuation">(</span><span class="token string">&quot;.app&quot;</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span>innerHTML <span class="token operator">=</span> hello<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>将 let 改为 const 后，检查通过，即 正常运行 ！</p></blockquote><p><img src="https://www.arryblog.com/assets/img/image-20231002213542750.373ce272.png" alt="image-20231002213542750"></p><h3 id="_5、安装-eslint-插件" tabindex="-1"><a class="header-anchor" href="#_5、安装-eslint-插件" aria-hidden="true">#</a> 5、安装 ESLint 插件</h3><p>TIP</p><p>除了使用脚本做代码检查，还可以安装 ESLint 的插件 ！来辅助开发。</p><p><img src="https://www.arryblog.com/assets/img/image-20231002215731413.fa916a3f.png" alt="image-20231002215731413"></p><p>安装成功后，在代码编译阶段将自动提示报错 ！</p><p><img src="https://www.arryblog.com/assets/img/image-20231002221032280.008c128d.png" alt="image-20231002221032280"></p><blockquote><p>点击快速修复，错误即可自动修复 ！</p></blockquote><p><img src="https://www.arryblog.com/assets/img/image-20231002221618435.a37c8755.png" alt="image-20231002221618435"></p><p>成功修复后，效果如下</p><p><img src="https://www.arryblog.com/assets/img/image-20231002221704161.d55f2012.png" alt="image-20231002221704161"></p><p>在 VSCode 的 <code>settings.json</code> 配置文件中，加入以下配置项</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token comment">// Ctrl + S 即可自动修复不符合 ESLint 要求的代码</span>
  <span class="token property">&quot;editor.codeActionsOnSave&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;source.fixAll.eslint&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/GIF-2023-10-2-22-28-21.ad3928df.gif" alt="GIF-2023-10-2-22-28-21"></p><h3 id="_6、babel-eslint-与-typescript-eslint" tabindex="-1"><a class="header-anchor" href="#_6、babel-eslint-与-typescript-eslint" aria-hidden="true">#</a> 6、babel-eslint 与 typescript-eslint</h3><p>TIP</p><p>如果我们使用过 Babel ，也使用过 Babel 的 ESLint，接下来对比 babel-eslint 与 typescript-eslint，它们两者之间的区别如下。</p><ul><li><code>babel-eslint</code>：支持 TypeScript 没有的额外的语法检查，抛弃 TypeScript，不支持类型检</li><li><code>typescript-eslint</code>：基于 TypeScript 的 AST，支持创建基于类型信息的规则（<code>tsconfig.json</code>）</li></ul><p><strong>使用建议：</strong></p><ul><li>两者底层机制不一样，不要一起使用</li><li>Babel 体系建议使用 babel-eslint，否则可以使用 typescript-eslint</li></ul><blockquote><p>以上内容是关于 TS 代码检查工具的演化过程</p></blockquote><h2 id="三、jest-单元测试" tabindex="-1"><a class="header-anchor" href="#三、jest-单元测试" aria-hidden="true">#</a> 三、Jest 单元测试</h2><p>TIP</p><p>Jest 是由 Facebook 开源的一款 JavaScript 测试框架。它非常易于使用，快速而且功能强大，被广泛用于 React 项目 和 Node.js 应用程序。</p><h3 id="_1、typescript-工具体系" tabindex="-1"><a class="header-anchor" href="#_1、typescript-工具体系" aria-hidden="true">#</a> 1、TypeScript 工具体系</h3><p>TIP</p><p>TS 的工具体系基本分成了 Babel 系 和 非 Babel 系，单元测试也不例外</p><p><img src="https://www.arryblog.com/assets/img/image-20231003152913730.e8088527.png" alt="image-20231003152913730"></p><p>注：</p><p>我们可以使用 Babel 系的 <code>babel-jest</code> ，它和 Babel 系的工具具有同样的缺点，即：对测试代码进行类型检查。</p><p>如果需要类型检查，就要使用非 Babel 系的 <code>ts-jest</code> ，接下来就学习这两种工具的使用</p><h3 id="_2、jest-工具的使用" tabindex="-1"><a class="header-anchor" href="#_2、jest-工具的使用" aria-hidden="true">#</a> 2、Jest 工具的使用</h3><p>TIP</p><p>依然在前面 <code>hello world</code> 工程中来实现</p><blockquote><p>工程目录如下</p></blockquote><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>icoding-ts
├─ .eslintrc.json
├─ .gitignore
├─ build
│ ├─ webpack.base.config.js
│ ├─ webpack.config.js
│ ├─ webpack.dev.config.js
│ └─ webpack.pro.config.js
├─ package-lock.json
├─ package.json
├─ README.md
├─ src
│ ├─ index.ts
│ └─ tpl
│ └─ index.html
└─ tsconfig.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-1、安装-jest-相关包" tabindex="-1"><a class="header-anchor" href="#_2-1、安装-jest-相关包" aria-hidden="true">#</a> 2.1、安装 Jest 相关包</h3><p>TIP</p><p>在命令行终端中输入如下命令，安装三个包 <code>jest</code> 、<code>ts-jest</code> 和 <code>@types/jest</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i jest ts-jest @types/jest <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>在 <code>package.json</code> 中配置测试脚本</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 添加测试脚本</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2、生成-jest-的配置文件" tabindex="-1"><a class="header-anchor" href="#_2-2、生成-jest-的配置文件" aria-hidden="true">#</a> 2.2、生成 Jest 的配置文件</h3><p>在命令行终端中输入如下命令，即可生成</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>npx ts-jest config:init
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>通过该命令生成了一个 <code>jest.config.js</code> 配置文件</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token doc-comment comment">/** <span class="token keyword">@type</span> <span class="token class-name"><span class="token punctuation">{</span><span class="token keyword">import</span><span class="token punctuation">(</span><span class="token string">&#39;ts-jest&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>JestConfigWithTsJest<span class="token punctuation">}</span></span> */</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 指定 preset 是 ts-jest</span>
  <span class="token literal-property property">preset</span><span class="token operator">:</span> <span class="token string">&quot;ts-jest&quot;</span><span class="token punctuation">,</span>
  <span class="token comment">// 测试环境为 node</span>
  <span class="token literal-property property">testEnvironment</span><span class="token operator">:</span> <span class="token string">&quot;node&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3、编写测试用例" tabindex="-1"><a class="header-anchor" href="#_3、编写测试用例" aria-hidden="true">#</a> 3、编写测试用例</h3><p>TIP</p><p>下面会编写两个简单的函数，再为它们编写一个测试用例</p><p>新建 <code>src/math.ts</code> 文件</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 定义加法函数</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义减法函数</span>
<span class="token keyword">function</span> <span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将函数导出</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  add<span class="token punctuation">,</span>
  sub<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写测试用例，在根目录中新建 <code>test</code> 文件夹，同时新建 <code>test/math.test.ts</code> 文件</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 导入 math 文件</span>
<span class="token keyword">const</span> math <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;../src/math&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 编写第一个测试用例</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;add: 1 + 1 = 2&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;add: 1 - 2 = -1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时，第一行代码报错了 “Require 语句不是导入语句的一部分”</p><p><img src="https://www.arryblog.com/assets/img/image-20231002233024700.db529750.png" alt="image-20231002233024700"></p><p>解决办法，在 <code>.eslintrc.json</code> 配置文件 <code>rules</code> 节点中添加如下选项即可</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;rules&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 关闭 不允许使用 require 语句的检查</span>
    <span class="token property">&quot;@typescript-eslint/no-var-requires&quot;</span><span class="token operator">:</span> <span class="token string">&quot;off&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行测试脚本</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/image-20231002234029531.4da45477.png" alt="image-20231002234029531"></p><blockquote><p>以上两个测试用例都已经通过了，使用 TS 的 Jest 的好处是：它能够在测试用例中进行类型检查。</p></blockquote><p>在 <code>test/math.test.ts</code> 中定义一个变量，故意制造一个明显的类型错误</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 故意制造一个明显的类型错误</span>
<span class="token keyword">const</span> x<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token string">&quot;icoding&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>再次运行测试脚本，观察是否能够检测出来</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/image-20231002234610928.1976c28b.png" alt="image-20231002234610928"></p><blockquote><p>运行测试脚本后，明确提示错误：不能将字符串赋值给 number</p></blockquote><h3 id="_4、babel-jest-工具的使用" tabindex="-1"><a class="header-anchor" href="#_4、babel-jest-工具的使用" aria-hidden="true">#</a> 4、babel-jest 工具的使用</h3><p>TIP</p><p>打开我们前面用到的 <code>ts-babel</code> 项目</p><blockquote><p>目录结构如下</p></blockquote><div class="language-markdown line-numbers-mode" data-ext="md"><pre class="language-markdown"><code>ts-babel
├─ .babelrc
├─ .gitignore
├─ package-lock.json
├─ package.json
├─ src
│ └─ index.ts
└─ tsconfig.json
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>安装 <code>jest</code>、<code>babel-jest</code> 和<code>@types/jest</code></p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> i jest babel-jest @types/jest <span class="token parameter variable">-D</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="_4-1、编写测试用例" tabindex="-1"><a class="header-anchor" href="#_4-1、编写测试用例" aria-hidden="true">#</a> 4.1、编写测试用例</h3><p>TIP</p><p>下面会编写两个简单的函数，再为它们编写一个测试用例</p><p>新建 <code>src/math.ts</code> 文件</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 定义加法函数</span>
<span class="token keyword">function</span> <span class="token function">add</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">+</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 定义减法函数</span>
<span class="token keyword">function</span> <span class="token function">sub</span><span class="token punctuation">(</span>a<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">,</span> b<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> a <span class="token operator">-</span> b<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 将函数导出</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  add<span class="token punctuation">,</span>
  sub<span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写测试用例，在根目录中新建 <code>test</code> 文件夹，同时新建 <code>test/math.test.ts</code> 文件</p><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// 导入 math 文件</span>
<span class="token keyword">const</span> math <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">&quot;../src/math&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 编写第一个测试用例</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;add: 1 + 1 = 2&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">&quot;add: 1 - 2 = -1&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>math<span class="token punctuation">.</span><span class="token function">sub</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> x<span class="token operator">:</span> <span class="token builtin">number</span> <span class="token operator">=</span> <span class="token string">&quot;icoding&quot;</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>package.json</code> 配置文件中，添加测试脚本</p><div class="language-json line-numbers-mode" data-ext="json"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;scripts&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token comment">// 添加测试脚本</span>
    <span class="token property">&quot;test&quot;</span><span class="token operator">:</span> <span class="token string">&quot;jest&quot;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再次运行测试脚本，观察是否能够检测出来</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run <span class="token builtin class-name">test</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/image-20231003000154238.4b83ee82.png" alt="image-20231003000154238"></p><blockquote><p>从运行结果可以看到，两个测试用例都成功检查通过了 ！但 并没有进行类型检查，以上明显的赋值错误并没有检查出来。</p></blockquote><h3 id="_4-2、启动类型检查脚本" tabindex="-1"><a class="header-anchor" href="#_4-2、启动类型检查脚本" aria-hidden="true">#</a> 4.2、启动类型检查脚本</h3><p>TIP</p><p>如果要进行类型检查，我们仍然需要启动类型检查脚本</p><p>新开一个命令行终端中输入如下命令</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">npm</span> run type-check
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><img src="https://www.arryblog.com/assets/img/image-20231003012843082.8cb2f4f2.png" alt="image-20231003012843082"></p><blockquote><p>运行命令脚本后，在控制台会实时监听所有错误信息，可根据错误提示来修改对应的代码即可</p></blockquote><p><img src="https://www.arryblog.com/assets/img/image-20231003013114222.b77025ee.png" alt="image-20231003013114222"></p><blockquote><p>修改后，控制提示通过检查 ！</p></blockquote><h2 id="四、ts-工程实践知识总结" tabindex="-1"><a class="header-anchor" href="#四、ts-工程实践知识总结" aria-hidden="true">#</a> 四、TS 工程实践知识总结</h2><p>TIP</p><p>总结 TypeScript 工程实践部分所学到的所有知识点，模块系统、命名空间，声明合并，<code>tsconfig.json</code> 主要配置，编译工具，代码检查工具，单元测试。</p><h3 id="_1、模块系统" tabindex="-1"><a class="header-anchor" href="#_1、模块系统" aria-hidden="true">#</a> 1、模块系统</h3><table><thead><tr><th style="text-align:left;">模块系统</th><th style="text-align:left;">导入</th><th style="text-align:left;">导出</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">ES6 模块</td><td style="text-align:left;">import</td><td style="text-align:left;">export export default</td><td style="text-align:left;">ES6 模块 与 CommonJS 模块不兼容</td></tr><tr><td style="text-align:left;">CommonJS 模块</td><td style="text-align:left;">require</td><td style="text-align:left;">exports module.exports</td><td style="text-align:left;">Node 环境运行 ts 文件使用 ts-node</td></tr></tbody></table><p>注：</p><p>处理两个模块系统（ES6 和 CommonJS ）模块之间的不兼容性问题，解决方案有两个：</p><ul><li>两种模块系统不要混用</li><li>如果你的 ES6 模块有一个顶级导出，而且可能会被 node 模块引用，TS 为我们提供了兼容性的语法</li></ul><div class="language-tsx line-numbers-mode" data-ext="tsx"><pre class="language-tsx"><code><span class="token comment">// export = 的方式，编译后就是 module.exports 就相当于 CommonJS 中的顶级导出</span>
<span class="token keyword">export</span> <span class="token operator">=</span> x<span class="token punctuation">;</span>
<span class="token keyword">import</span> x <span class="token operator">=</span> <span class="token keyword">require</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2、命名空间" tabindex="-1"><a class="header-anchor" href="#_2、命名空间" aria-hidden="true">#</a> 2、命名空间</h3><table><thead><tr><th style="text-align:left;">实现原理</th><th style="text-align:left;">要点</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">立即执行函数构成的闭包</td><td style="text-align:left;">局部变量对外不可见 导出成员对外可见 多个文件可共享同名命名空间 依赖关系 <code>/// &lt;reference path=&quot;&quot; /&gt;</code></td><td style="text-align:left;">注：不要与模块混用</td></tr></tbody></table><h3 id="_3、声明合并" tabindex="-1"><a class="header-anchor" href="#_3、声明合并" aria-hidden="true">#</a> 3、声明合并</h3><p>TIP</p><p>定义：多个具有相同名称的声明会合并为一个声明</p><table><thead><tr><th style="text-align:left;">合并类型</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">接口之间合并</td><td style="text-align:left;">非函数成员保证唯一性 函数成员成为函数重载，重载的顺序如下： ①、函数参数为字符串字面量，提升到最顶端 ②、接口之间，后面的接口靠前 ③、接口内部，按书写顺序</td></tr><tr><td style="text-align:left;">命名空间之间合并</td><td style="text-align:left;">导出的成员不可重复定义或实现</td></tr><tr><td style="text-align:left;">命名空间与类合并</td><td style="text-align:left;">为类添加静态成员</td></tr><tr><td style="text-align:left;">命名空间与函数合并</td><td style="text-align:left;">为函数添加属性和方法</td></tr><tr><td style="text-align:left;">命名空间与枚举合井</td><td style="text-align:left;">为枚举添加属性和方法</td></tr></tbody></table><p>注：</p><p>命名空间要在类和函数声明之后</p><h3 id="_4、tsconfig-json-主要配置" tabindex="-1"><a class="header-anchor" href="#_4、tsconfig-json-主要配置" aria-hidden="true">#</a> 4、tsconfig.json 主要配置</h3><p>TIP</p><p>TypeScript 中 <code>tsconfig.json</code> 配置文件中的主要配置信息，包括：文件选项、编译选项、工程引用</p>`,243),y={href:"https://www.arryblog.com/vip/ts/note-tsconfig-tsc.html",target:"_blank",rel:"noopener noreferrer"},x=a('<h3 id="_4-1、文件选项" tabindex="-1"><a class="header-anchor" href="#_4-1、文件选项" aria-hidden="true">#</a> 4.1、文件选项</h3><table><thead><tr><th style="text-align:left;">文件选项</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">files</td><td style="text-align:left;">需要编译的单个文件列表</td></tr><tr><td style="text-align:left;">inclue</td><td style="text-align:left;">需要编译的文件或目录</td></tr><tr><td style="text-align:left;">exclude</td><td style="text-align:left;">需要排除的文件或目录</td></tr><tr><td style="text-align:left;">extends</td><td style="text-align:left;">配置文件继承</td></tr></tbody></table><h3 id="_4-2、编译选项" tabindex="-1"><a class="header-anchor" href="#_4-2、编译选项" aria-hidden="true">#</a> 4.2、编译选项</h3><table><thead><tr><th style="text-align:left;">编译选项</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">incremental</td><td style="text-align:left;">增量编译</td></tr><tr><td style="text-align:left;">target</td><td style="text-align:left;">目标语言</td></tr><tr><td style="text-align:left;">module</td><td style="text-align:left;">目标模块系统</td></tr><tr><td style="text-align:left;">outFile</td><td style="text-align:left;">将多个依赖文件生成一个文件（amd 模块）</td></tr><tr><td style="text-align:left;">lib</td><td style="text-align:left;">引用类库</td></tr><tr><td style="text-align:left;">allowJs</td><td style="text-align:left;">允许编译 JS 文件</td></tr><tr><td style="text-align:left;">outDir</td><td style="text-align:left;">输出目录</td></tr><tr><td style="text-align:left;">rootDir</td><td style="text-align:left;">输入目录，用于调整输出目录结构</td></tr><tr><td style="text-align:left;">declaration</td><td style="text-align:left;">生成声明文件</td></tr><tr><td style="text-align:left;">sourceMap</td><td style="text-align:left;">生成 sourceMap</td></tr><tr><td style="text-align:left;">noEmit</td><td style="text-align:left;">不输出文件</td></tr><tr><td style="text-align:left;">esModuleInterop</td><td style="text-align:left;">允许 <code>export =</code> 导出，由 <code>import from</code> 导入</td></tr><tr><td style="text-align:left;">allowUmdGlobalAccess</td><td style="text-align:left;">允许在模块中访问 UMD 全局变量</td></tr><tr><td style="text-align:left;">moduleResolution</td><td style="text-align:left;">模块解析策略</td></tr><tr><td style="text-align:left;">baseUrl</td><td style="text-align:left;">解析非相对模块的基地址</td></tr><tr><td style="text-align:left;">paths</td><td style="text-align:left;">路径映射，相对于 baseUrl</td></tr><tr><td style="text-align:left;">rootDirs</td><td style="text-align:left;">将多个目录放在一一个虚拟目录下，方便运行时访问</td></tr></tbody></table><p><code>&quot;strict&quot;: true</code> 选项，这个设置相当于同时打开以下的一系列设置</p><table><thead><tr><th style="text-align:left;">编译选项</th><th style="text-align:left;">描述</th><th style="text-align:left;">代码</th></tr></thead><tbody><tr><td style="text-align:left;">alwaysStrict</td><td style="text-align:left;">总是在编译产物的头部添加<code>use strict</code></td><td style="text-align:left;">注入 <code>&quot;use strict&quot;</code></td></tr><tr><td style="text-align:left;">noImplicitAny</td><td style="text-align:left;">类型推断只要为<code>any</code>类型就报错</td><td style="text-align:left;"><code>function(x) {}</code></td></tr><tr><td style="text-align:left;">strictNullChecks</td><td style="text-align:left;">对<code>null</code>和<code>undefined</code>进行严格类型检查</td><td style="text-align:left;"><code>let x: number = null</code></td></tr><tr><td style="text-align:left;">strictFunctionTypes</td><td style="text-align:left;">允许对函数更严格的参数检查</td><td style="text-align:left;"><code>let a = (x: number) =&gt; {}</code> <code>let b = (y?: number) =&gt; {}</code> <code>b = a</code></td></tr><tr><td style="text-align:left;">strictPropertyInitialization</td><td style="text-align:left;">类的属性必须进行初始值，但是允许在构造函数里面赋值</td><td style="text-align:left;"><code>class C {</code> <code>x: number</code> <code>}</code></td></tr><tr><td style="text-align:left;">strictBindCallApply</td><td style="text-align:left;">是否对函数的<code>call()</code>、<code>bind()</code>、<code>apply()</code>这三个方法进行类型检查</td><td style="text-align:left;"><code>function add(x: number, y: number) {</code> <code>return x + y;</code> <code>}</code> <code>add.call(undefined, 1, &#39;2&#39;)</code></td></tr><tr><td style="text-align:left;">noImplicitThis</td><td style="text-align:left;">设置如果<code>this</code>被推断为<code>any</code>类型是否报错</td><td style="text-align:left;"><code>class B {</code> <code>a: number = 1;</code> <code>getA() {</code> <code>return function () {</code> <code>console.log(this.a);</code> <code>}</code> <code>}</code> <code>}</code></td></tr></tbody></table><h3 id="_4-3、工程引用" tabindex="-1"><a class="header-anchor" href="#_4-3、工程引用" aria-hidden="true">#</a> 4.3、工程引用</h3><table><thead><tr><th style="text-align:left;">选项</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">composite</td><td style="text-align:left;">工程可以被引用和进行增量编译</td></tr><tr><td style="text-align:left;">declaration</td><td style="text-align:left;">必须开启</td></tr><tr><td style="text-align:left;">references</td><td style="text-align:left;">该工程所依赖的工程</td></tr><tr><td style="text-align:left;">tsc --build 模式</td><td style="text-align:left;">单独构建一个工程，依赖工程也会被构建</td></tr></tbody></table><h3 id="_5、编译工具" tabindex="-1"><a class="header-anchor" href="#_5、编译工具" aria-hidden="true">#</a> 5、编译工具</h3><table><thead><tr><th style="text-align:left;">编译工具</th><th style="text-align:left;">配置描述</th></tr></thead><tbody><tr><td style="text-align:left;">ts-loader</td><td style="text-align:left;">默认配置 transpileOnly：只做语言转换，不做类型检查 fork-ts-checker-webpack-plugin：独立的类型检查进程</td></tr><tr><td style="text-align:left;">awesome-typescript-loader</td><td style="text-align:left;">默认配置 transpileOnly：只做语言转换，不做类型检查 CheckerPlugin（内置）：独立的类型检查进程</td></tr><tr><td style="text-align:left;">Babel</td><td style="text-align:left;"><strong>只做语言转换：</strong> <code>@babel/preset-typescript</code> <code>@babe/proposal-class-properties</code> <code>@babel/proposal-object-rest- spread</code> <strong><code>tsc --watch</code> 模式：</strong> 类型检查 <strong>无法编译的 TypeScript 特性：</strong> ①、namespace：不要使用 ②、<code>&lt;typename&gt;</code> 类型断言，改用 <code>as typename</code> ③、<code>const enum</code> 未来可期 ④、<code>export =</code> 不要使用</td></tr></tbody></table><h3 id="_6、代码检查工具" tabindex="-1"><a class="header-anchor" href="#_6、代码检查工具" aria-hidden="true">#</a> 6、代码检查工具</h3><table><thead><tr><th style="text-align:left;">检查工具</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">TSLint</td><td style="text-align:left;">官方已弃用</td></tr><tr><td style="text-align:left;">ESLint</td><td style="text-align:left;">eslint：与 TypeScript 的 AST 不兼容 typescript-eslint： ①、<code>@typescript- eslint/parser</code>：替换 ESLint 的解析器 ②、<code>@typescript- eslint/eslint- plugin</code>：使 ESLint 能够识别一些特殊的 TypeScript 语法</td></tr><tr><td style="text-align:left;">VSCode ESLint 插件</td><td style="text-align:left;"><code>Ctrl + S</code> 即可自动修复不符合 ESLint 要求的代码 在 <code>settings.json</code> 文件中配置如下： <code>&quot;editor.codeActionsOnSave&quot;: {</code> <code>&quot;source.fixAll.eslint&quot;: true</code> <code>}</code></td></tr><tr><td style="text-align:left;">babel- eslint</td><td style="text-align:left;">适用于 Babel 体系</td></tr></tbody></table><h3 id="_7、单元测试" tabindex="-1"><a class="header-anchor" href="#_7、单元测试" aria-hidden="true">#</a> 7、单元测试</h3><table><thead><tr><th style="text-align:left;">工具</th><th style="text-align:left;">描述</th></tr></thead><tbody><tr><td style="text-align:left;">ts-jest</td><td style="text-align:left;">有类型检查</td></tr><tr><td style="text-align:left;">babel-jest</td><td style="text-align:left;">无类型检查</td></tr></tbody></table>',14);function f(q,w){const e=l("ExternalLinkIcon");return o(),i("div",null,[d,n("ul",null,[r,n("li",null,[s("此外，"),u,s(" 还会有一些自己的配置，会通过 "),k,s(" 属性传入。其中的配置项可以参考 "),n("a",m,[s("ts-loader 的官方文档(opens new window)"),t(e)])])]),b,n("p",null,[s("除了 "),v,s(" ，还有另一个 leader。 即："),n("a",g,[s("awesome-typescript-loader(opens new window)"),t(e)])]),h,n("blockquote",null,[n("p",null,[s("详细配置项，点击查阅 "),n("a",y,[s("https://www.arryblog.com/vip/ts/note-tsconfig-tsc.html(opens new window)"),t(e)])])]),x])}const S=p(c,[["render",f],["__file","TS gongchengshijianzhongdebianyigongju，daimajianchagongju，danyuanceshi.html.vue"]]);export{S as default};
